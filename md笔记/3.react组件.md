### 1.å‡½æ•°ç»„ä»¶

```jsx
1. ä¸€ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ªjsxå¯¹è±¡å°±æ˜¯ä¸€ä¸ªå‡½æ•°ç»„ä»¶
const DemoOne = (props) => {
    console.log(props)
    return <div>å‡½æ•°ç»„ä»¶</div>
}
export default DemoOne;
```

```jsx
2.ä½¿ç”¨å‡½æ•°ç»„ä»¶
import DemoOne from './views/DemoOne';
 <>
    {<DemoOne  title='12' data={[12,12]}/>}
  </>
```

```jsx
3.ç»„ä»¶çš„å‘½åä¸€èˆ¬ä½¿ç”¨å¤§é©¼å³°å‘½å
```

```jsx

4.ç»™ç»„ä»¶ä¼ é€’å±æ€§å€¼
 <>
    {<DemoOne title="123" data={[1,2,34,5]}  />}
  </>

// éå­—ç¬¦ä¸²çš„å€¼å’Œnumberçš„å€¼è¦åŠ {}è¿›è¡Œä¼ é€’
// ç»„ä»¶çš„React.createEelementçš„typeä¸ºfunctionï¼Œä¸æ˜¯åƒå…ƒç´ ä¸€æ ·çš„å­—ç¬¦ä¸²å€¼ï¼Œ


```

```jsx
5.å‡½æ•°ç»„ä»¶çš„æ¸²æŸ“æœºåˆ¶(å•é—­åˆ)

@1 åŸºäºbabel-preset-react-appå§è°ƒç”¨çš„ç»„ä»¶è½¬æ¢ä¸ºcreateElementå½¢å¼
	React.createElement(DemoOne,{
	    title:'',
	    data:[10,20],
	   
	})
@2 å°†createElementçš„çš„æ–¹æ³•æ‰§è¡Œï¼Œåˆ›å»ºä¸€ä¸ªvirtualDOMå¯¹è±¡
{
	$$typeof: Symbol(react.element),
	key: null,
	props: {title: 12, data: Array(2)},// å¦‚æœæœ‰å­èŠ‚ç‚¹	[åŒé—­åˆè°ƒç”¨<demo />]ï¼Œåˆ™ä¹ŸåŒ…å«children
	ref: null,
	type: () => {â€¦}
}
@3.root.renderæŠŠvirtualdomè½¬æ¢ä¸ºçœŸå®çš„dom
	typeä¸ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè€Œæ˜¯ä¸€ä¸ªå‡½æ•°
	å°†å‡½æ•°æ‰§è¡Œ --> demoOne()
	å°†virtualdemoçš„propsä¼ é€’ç»™å‡½æ•° demoone(props)[çˆ¶ä¼ å­]
	æ¥å—å‡½æ•°è¿”å›çš„ç»“æœï¼Œå°±æ˜¯ä¸€ä¸ªvirtualdomå¯¹è±¡
	æœ€årenderæŠŠvdomè½¬æ¢ä¸ºçœŸå®domï¼Œç„¶åæ’å…¥åˆ°å®¹å™¨ä¸­

```

```jsx
6.å•é—­åˆå’ŒåŒé—­åˆçš„åŒºåˆ«(å•é—­åˆæ‹¿ä¸åˆ°childrenï¼ŒåŒé—­åˆå¯ä»¥æ‹¿åˆ°childrenå±æ€§)
	åŒé—­åˆå¯ä»¥ä¼ é€’å­èŠ‚ç‚¹
	 {
		<DemoOne title='123' data={[1,2,3,4]}>
        		<div>welcome</div>
     		 </DemoOne>
      	  }
@1 é€šè¿‡babel-preset-env-react-appå°†jsxè½¬æ¢ä¸ºjs		   
		React.createElement(DemoOne, {
  			title: "123",
  			data: [1, 2, 3, 4]
		}, 
			React.createElement("div", null, "welcome") // demoä¸‹é¢å¤šäº†ä¸€ä¸ªdiv
		);
@2 æ‰§è¡ŒcreateElementè½¬æ¢ä¸ºä¸€ä¸ªvdom
	{
  	children: {$$typeof: Symbol(react.element), type: 'div', key: null, ref: null, props: {â€¦}, â€¦}
  	data: [1, 2, 3, 4]
  	title: "123"
	}
@3 render

```

### 2. props

```js
å¯¹è±¡å†»ç»“: Object.freeze(obj) --> æ£€æµ‹å¯¹è±¡æ˜¯å¦è¢«å†»ç»“Object.isFrozen --> è¢«å†»ç»“çš„å¯¹è±¡ä¸èƒ½ä¿®æ”¹ï¼Œæ–°å¢ä¿®æ”¹ï¼Œä¸èƒ½è¢«å¯¹è±¡åšåŠ«æŒï¼ˆObject.definePropertyï¼‰

å¯¹è±¡è¢«å¯†å°ï¼šObject.seal(obj) --> æ£€æµ‹å¯¹è±¡è¢«å¯†å° Object.isSealed() --> è¢«å¯†å°çš„å¯¹è±¡å¯ä»¥ä¿®æ”¹ï¼Œä¸èƒ½æ–°å¢ï¼Œä¸èƒ½åˆ é™¤ï¼Œä¹Ÿä¸èƒ½åšåŠ«æŒ

å¯¹è±¡æ‰©å±•ï¼šObject.preventExtensions(obj) è®¾ç½®ä¸å¯æ‰©å±• --> Object.isExtensible() æ£€æµ‹æ˜¯å¦å¯æ‰©å±• --> ä¸èƒ½æ–°å¢ï¼Œå…¶ä½™éƒ½å¯ä»¥
```

```jsx
1.propsä¼ é€’è¿‡æ¥çš„å±æ€§æ˜¯åªè¯»çš„[å¯¹è±¡è¢«å†»ç»“äº†],åªèƒ½è·å–ä¸èƒ½ä¿®æ”¹
   // Object.isFrozn(props) --> true
    const DemoOne = (props) => {
      let className = props.className
      let title = props.title
      return <div className={className}>{title}</div>
     }

```

```jsx
2.propsè§„åˆ™æ ¡éªŒ
@1. è®¾ç½®é»˜è®¤å€¼(è®¾ç½®å‡½æ•°é™æ€çš„ç§æœ‰å±æ€§æ–¹æ³•))
	DemoOne.defaultProps = {
    		className: 'demo-one',
    		title: 'demo-one'
	}
@2. è®¾ç½®æ•°æ®æ ¼å¼ï¼Œæ˜¯å¦å¿…ä¼ ï¼ˆä¾èµ–äºå®˜æ–¹æ’ä»¶prop-types[é»˜è®¤è„šæ‰‹æ¶ä¸­ä¸å­˜åœ¨]ï¼‰[ä¼ é€’è¿‡æ¥çš„å€¼é¦–å…ˆç»è¿‡Propæ ¡éªŒï¼Œæ ¡éªŒä¸ç®¡æ˜¯å¦æˆåŠŸéƒ½ä¼šç»™propsï¼Œä½†æ˜¯æ§åˆ¶å°ä¼šå‡ºç°è­¦å‘Šé”™è¯¯]
	import  PropTypes from "prop-types";
	DemoOne.propTypes = {
		className: PropTypes.string.isRequired,
    		title: PropTypes.oneOfType([
        		PropTypes.string,
        		PropTypes.number
    		]).isRequired
	}


```

```jsx
3.é€šè¿‡è§£æ„çš„æ–¹æ³•ä¿®æ”¹props(è¿™æ ·å°±ä¸ä¼šå½±å“åˆ°propså¯¹è±¡çš„å€¼äº†)
	const DemoOne = (props) => {
    		let {className, title} = props;
    		className =  '123'
    		title = '123'
    		return <div className={className}>{title}</div>
	}
```

### 3. æ’æ§½

```jsx
1.æ’æ§½çš„ä½¿ç”¨
const DemoOne = (props) => {
    let {className, title, children} = props;

    return <div className={className}>
        {title}
        {children} // å°†children[demoä¸­çš„å­èŠ‚ç‚¹]è¿›è¡Œæ¸²æŸ“[æ’æ§½]
    </div>
}
```

```jsx
1.å…·åæ’æ§½ ï¼ˆReact.Children.toArray()ï¼‰
çˆ¶ç»„ä»¶
<>
    {
      <DemoOne >
        <b>234</b>
        <b>123</b>
        <div slot="footer">æˆ‘æ˜¯é¡µå°¾</div>
        <div slot="header"> æˆ‘æ˜¯é¡µå¤´ </div>
      </DemoOne>
      }
  </>
å­ç»„ä»¶
const DemoOne = (props) => {
    let {className, title, children} = props;
    // åˆ¤æ–­childrenæ˜¯å¦æ˜¯æ•°ç»„,ä¼ é€’ä¸€ä¸ªå­èŠ‚ç‚¹å¯èƒ½ä¸ä¸ºæ•°ç»„
    // children = Array.isArray(children) ? children : [children];-->æ›¿æ¢ä¸ºchildren = React.Children.toArray(children)
    children = React.Children.toArray(children)
    // åŸºäºReact.Childrenå¯¹childrenè¿›è¡Œå¤„ç†
    // å¥½å¤„ï¼šæ–¹æ³•çš„å†…éƒ¨ã€å·²ç»å¯¹childrençš„å„ç§æƒ…å†µåšå‡ºäº†å¤„ç†
    let header = children.find((item)=>{
        return item.props.slot=='header'
    })
    let footer = children.find((item)=>{
        return item.props.slot=='footer'
    })
    let defaultSlot = children.filter((item)=>{
        return !item.props.slot
    })
    return <div className={className}>
        <div className='header'> {header} </div>
        {title}
         <div className='footer'> {footer} </div>
         <div>{defaultSlot}</div>
    </div>
}
```

### 4.ç»ƒä¹ ï¼šå°è£…ä¸€ä¸ªdialogçš„ç»„ä»¶

```jsx
root.render(
  <>
    {
      <Dialog title="ç¬¬ä¸€ä¸ªdialog" content="ç¬¬ä¸€ä¸ª">
        <button slot="comfirm">comfirm</button>
        <button slot = "cancel">cancel</button>
      </Dialog>
    }
    {
      <Dialog title="ç¬¬äºŒä¸ªdialog" content="ç¬¬äºŒä¸ª" />
    }
     {
      <Dialog title="ç¬¬ä¸‰ä¸ªdialog" content="ç¬¬ä¸‰ä¸ª">
        <button slot="comfirm">comfirm</button>
      </Dialog>
    }
  </>
);
import PropTypes from "prop-types";
import React from "react";
const Dialog = (props) => {
    let { title, content ,children} = props;
    children = React.Children.toArray(children);
    let slotComfirm = children.find(item => item.props.slot === "comfirm");
    let slotCancel = children.find(item => item.props.slot === "cancel");
    return (
        <>
            <div className="dialog">
                <h1>{title}</h1>
                <div className="content">{content}</div>
                {children.length>0 ? <div className="footer" >
                   {slotComfirm? <span>{slotComfirm}</span> : '' }
                    {slotCancel?<span>{slotCancel}</span>:''}
                </div> : ''}
            </div>
        </>
    )
    console.log("props")

}
Dialog.defaultProps = {
    title: "æ ‡é¢˜",
    content: "å†…å®¹"
}
Dialog.propTypes = {
    title:PropTypes.string.isRequired, 
    content:PropTypes.string.isRequired
}
export default Dialog;


```

### 5. é™æ€ç»„ä»¶å’ŒåŠ¨æ€ç»„ä»¶

#### 5.1.é™æ€ç»„ä»¶ï¼ˆå‡½æ•°ç»„ä»¶ï¼‰

```jsx
 1ã€åŸºæœ¬æ¦‚å¿µï¼šæ¸²æŸ“ä¸€æ¬¡åï¼Œåé¢çš„ç»„ä»¶å°±ä¸ä¼šæ¸²æŸ“äº†(é™¤éçˆ¶ç»„ä»¶è§¦å‘å­ç»„ä»¶å»æ›´æ–° æˆ–è€… ä½¿ç”¨hooksç»„ä»¶ ã€åŠ¨æ€ç»„ä»¶)ï¼Œåªå…·å¤‡å±æ€§è¿™ä¸ªç‰¹ç‚¹

 2ã€ é™æ€ç»„ä»¶çš„æ¸²æŸ“æ­¥éª¤
 
    2.1 ç¬¬ä¸€æ¬¡æ¸²æŸ“
  
         + äº§ç”Ÿä¸€ä¸ªä¸Šä¸‹æ–‡
         + å°†props[children]ä¼ å…¥å‡½æ•°ä¸­
         + å°†å‡½æ•°çš„è¿”å›å€¼ï¼ˆvdomï¼‰æ¸²æŸ“åˆ°é¡µé¢ä¸­

    2.2  ç¬¬äºŒæ¬¡æ¸²æŸ“ï¼Œç‚¹å‡»æŒ‰é’®çš„æ—¶å€™
  
         + ä¿®æ”¹ä¸Šä¸‹æ–‡çš„å€¼
         + ç§æœ‰å˜é‡å‘ç”Ÿå˜åŒ–ä½†æ˜¯è§†å›¾æœªæ”¹å˜
   
  3ã€ä¼˜ç‚¹ï¼š å¯¹æ¯”äºç±»ç»„ä»¶ï¼šå†…éƒ¨æœºåˆ¶ç®€å•ï¼Œæ¸²æŸ“é€Ÿåº¦æ›´å¿«
```

<div style="color:red">é™æ€ç»„ä»¶æ— æ³•æ”¹å˜å€¼ï¼šä»£ç </div>

```jsx
// é™æ€ç»„ä»¶æ¸²æŸ“åæ— æ³•é€šè¿‡æ”¹å˜å€¼æ¥æ›´æ–°è§†å›¾ ï¼ˆä»£ç ï¼‰
const Vite = (props)=>{
    const {title} = props;
    let opnum = 0;
    let agnum = 0;
    return (<>
        <div>
            <h2>{title}</h2>
            <div>æ€»äººæ•°{opnum + agnum}</div>
        </div>
        <div>
            <p>åå¯¹äººæ•°ï¼š{agnum}</p>
            <p>æ”¯æŒäººæ•°:{opnum}</p>
        </div>
        <div>
            <button onClick={
                ()=>{
                    opnum++;
                    console.log(opnum);
                }
            }>åå¯¹ğŸ™…</button>
            <button onClick = {
                ()=>{
                    agnum++; // é™æ€ç»„ä»¶ï¼šnumå€¼ä¸ä¼šæ›´æ–°
                    console.log(agnum);
                }
            }>æ”¯æŒ</button>
        </div>
    </>)
}
```

#### 5.2 ã€åŠ¨æ€ç»„ä»¶ï¼ˆç±»ç»„ä»¶ï¼‰

```jsx
åŸºæœ¬æ¦‚å¿µï¼šé™¤äº†çˆ¶ç»„ä»¶æ›´æ–°è§¦å‘æ›´æ–°ä»¥å¤–ï¼Œè¿˜èƒ½åœ¨ç»„ä»¶å†…éƒ¨é€šè¿‡setstateæ”¹å˜ç»„ä»¶çš„çŠ¶æ€è¿›è¡Œæ›´æ–°ï¼Œè¿˜å…·å¤‡çŠ¶æ€ã€å±æ€§ã€ç”Ÿå‘½å‘¨æœŸå‡½æ•°å’Œrefç­‰ç‰¹ç‚¹ï¼ŒåŸºæœ¬ä¸Šä¸€ä¸ªç»„ä»¶æœ‰çš„éƒ½å…·å¤‡

1. è§£å†³é—®é¢˜ï¼š

		 + åŠ¨æ€ç»„ä»¶(ç±»ç»„ä»¶)è§£å†³å‡½æ•°ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“åæ— æ³•æ›´æ–°è§†å›¾çš„é—®é¢˜ï¼ˆhooksç»„ä»¶ä¹Ÿå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼šåœ¨å‡½æ•°ç»„ä»¶ä¸­ä½¿ç”¨hookså‡½æ•°ï¼‰

2. åŸºæœ¬ä½¿ç”¨

		 + åˆ›å»ºä¸€ä¸ªç±»ï¼Œå¿…é¡»ç»§æ‰¿React.Component/React.PureComponent

		 + åœ¨ç±»ä¸­ï¼Œå¿…é¡»æä¾›ä¸€ä¸ªrenderå‡½æ•°ï¼Œéœ€è¦åœ¨åŸå‹ä¸Š

		 + åœ¨renderæ–¹æ³•ä¸­è¿”å›ä¸€ä¸ªéœ€è¦æ¸²æŸ“çš„è§†å›¾
3. ä¼˜ç‚¹ï¼šåŠŸèƒ½å¼ºå¤§
```

### 6.  classåŸºæœ¬åŸç†

```jsx
class Point {
    #self = 0  // ç§æœ‰å±æ€§ï¼Œåœ¨ç±»çš„å¤–éƒ¨ä½¿ç”¨å°±ä¼šæŠ¥é”™ï¼Œåœ¨å†…éƒ¨ä½¿ç”¨this.#self --> å¯ä»¥ä½¿ç”¨inæ¥åˆ¤æ–­ç§æœ‰å±æ€§(åªèƒ½åœ¨ç±»çš„å†…éƒ¨åˆ¤æ–­#self in Point)
    static #region  = "city"  // é™æ€çš„ç§æœ‰å±æ€§
    #sum(){ //ç§æœ‰æ–¹æ³•

    }
    get #g(){ // ç§æœ‰å±æ€§çš„getå’Œset

    }
    z = 100 // å®šä¹‰åœ¨å®ä¾‹å¯¹è±¡çš„ä¸Šé¢ï¼Œè€Œä¸æ˜¯åŸå‹ä¸Šé¢
    constructor(x, y) { // æŒ‚è½½åœ¨åŸå‹ä¸Šäº† Point.prototype.constructor
      this.x = x;       // æ²¡æœ‰constructoræ–¹æ³•ï¼Œç±»ä¼šè‡ªåŠ¨è¡¥å……ä¸€ä¸ªconstructor(){}
      this.y = y;
  
    }
  
    toString() { // æŒ‚è½½åœ¨åŸå‹ä¸Šäº† Point.prototype.toString
        console.log('ç§æœ‰',this.#self in  this)
      return '(' + this.x + ', ' + this.y + ')';
    }
    a = ()=>{
   
        console.log(1)
    }
    get b(){ // å­˜åœ¨å±æ€§descriptorå¯¹è±¡ä¸Š -->è·å– Object.getOwnPropertyDescriptor
        return this.#self // å®åˆ—ä¹Ÿå¯ä»¥è·å¾—ç§æœ‰å±æ€§
    }
    set b(value){
        this.x= value
    }
    static v(){ // é™æ€æ–¹æ³•ï¼ŒPoint.v()è°ƒç”¨,ä¹Ÿå¯ä»¥è¢«ç»§æ‰¿ï¼Œç»§æ‰¿åå¯ä»¥é€šè¿‡super.v()è°ƒç”¨
        console.log("this",this ) //-->thisä¸ºPoint
    }
    static h = 100 // é™æ€å±æ€§
  }
  Point.h = 100 // é™æ€å±æ€§

  let point = new Point(1,2)
  console.log("point",point)
  console.log(point.toString())
  console.log("Point",Point.h)
  console.log(typeof Point, Point === Point.prototype.constructor) // ç±»æœ¬èº«å°±æŒ‡å‘æ„é€ å‡½æ•°
  console.log(point.constructor === Point.prototype.constructor) // true
 //  ç±»å†…éƒ¨çš„æ–¹æ³•ä¸å¯æšä¸¾
  console.log(Object.keys(Point.prototype)) // []
  console.log(Object.getOwnPropertyNames(Point.prototype)) // ['constructor', 'toString']

  console.log(Object.getOwnPropertyDescriptor(Point.prototype,'b')
```

```jsx

2. new ç±»ç»„ä»¶çš„æ—¶å€™å‘ç”Ÿçš„çš„å˜åŒ–
/**

åŠ¨æ€ç»„ä»¶å¯ä»¥åœ¨åˆ›å»ºå®Œæˆåï¼Œé€šè¿‡å†…éƒ¨çš„çŠ¶æ€æˆ–è€…å±æ€§ï¼Œä¿®æ”¹è§†å›¾



å¦‚ä½•ç»§æ‰¿ï¼š

	1.åŸºäºcallç»§æ‰¿ï¼ŒReact.Component.call(this) // this->parentç±»çš„å®ä¾‹

		function Component(props,context,updater){

				this.props = props

				this.context = context

				this.refs = refs

				this.updater = updater || ReactNoopUpdateQueue;

		}

	2.ç»™åˆ›å»ºçš„å®ä¾‹æ·»åŠ äº†å››ä¸ªç§æœ‰å±æ€§ï¼šprops/context/refs/updater

	3.åŸºäºåŸå‹ç»§æ‰¿ï¼ŒVote.prototype.proto == React.Component.prototype == Object.prototype

æ‰€ä»¥å®ä¾‹å¯ä»¥ä½¿ç”¨ParentåŸå‹ä¸Šé¢çš„æ–¹æ³•ä¹Ÿå¯ä»¥ä½¿ç”¨ReactComponent.prototypeä¸Šçš„æ–¹æ³• isReactComponent,setStaet,forceUpdate

 */
import React from 'react';
class Vote extends React.Component{
  /*
        constructor(){
            super(10) // ç­‰åŒäºæ‰§è¡ŒReact.Componet.call(this)
            // this.props = 10, this.context = undefined ,this.refs = undefined
        }
        */
   constructor(props){
        super(props)
        // this.props = props
   }
    render(){
        return (<>
            ...
        	</>)
    }
}
export default Vote;
```

### 7. ç±»ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„åº•å±‚é€»è¾‘

#### 7.1ã€ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„æµç¨‹

```jsx

1. è°ƒç”¨ç±»ç»„ä»¶
	+ renderå‡½æ•°æ¸²æŸ“çš„æ—¶å€™ï¼Œå¦‚æœtypeä¸ºï¼š

		   - renderå‡½æ•°æ¸²æŸ“çš„æ—¶å€™ï¼Œå¦‚æœtypeâ¬†ï¸ï¼š
 				  (1) å­—ç¬¦ä¸²ï¼šåˆ›å»ºä¸€ä¸ªæ ‡ç­¾
 				  (2) æ™®é€šå‡½æ•°ï¼šå°†å‡½æ•°æ‰§è¡Œï¼Œå°†propsä¼ å…¥å‡½æ•°
				  (3) æ„é€ å‡½æ•°ï¼š å°†æ„é€ å‡½æ•°ç”¨newæ‰§è¡Œã€åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹ã€‘ï¼Œä¹Ÿä¼šå°†è§£æçš„propsä¼ é€’è¿‡å»

			 

2.  è°ƒç”¨ç±»ç»„ä»¶å¼€å§‹ï¼Œç±»ç»„ä»¶å†…éƒ¨çš„å˜åŒ–
  
      2.1 æ ¡éªŒè§„åˆ™ && åˆå§‹åŒ–å±æ€§ï¼ˆgetSatePropsï¼‰
         è°ƒç”¨ç±»ç»„ä»¶çš„æ—¶å€™ï¼Œå…ˆè¿›è¡Œpropsçš„ç±»å‹æ ¡éªŒ ï¼Œç„¶åé€šè¿‡super(props)å°†propsæŒ‚è½½åˆ°thiså®ä¾‹ä¸Š(@1)ï¼Œç„¶åè¿›è¡Œrenderæ¸²æŸ“
   
         	@1çš„ä¸‰ä¸ªæ­¥éª¤
					(1). åŸºäºcallç»§æ‰¿ï¼ŒReact.Component.call(this) // this->parentç±»çš„å®ä¾‹
						/*
            function Component(props,context,updater){

                this.props = props

                this.context = context

                this.refs = refs

                this.updater = updater || ReactNoopUpdateQueue;

            }
            */

				(2). ç»™åˆ›å»ºçš„å®ä¾‹æ·»åŠ äº†å››ä¸ªç§æœ‰å±æ€§ï¼šprops/context/refs/updater

				(3). åŸºäºåŸå‹ç»§æ‰¿ï¼ŒVote.prototype.proto == React.Component.prototype == Object.prototype,æ‰€ä»¥å®ä¾‹å¯ä»¥ä½¿ç”¨ParentåŸå‹ä¸Šé¢çš„æ–¹æ³•ä¹Ÿå¯ä»¥ä½¿ç”¨ReactComponent.prototypeä¸Šçš„æ–¹æ³• isReactComponent,setStaet,forceUpdate

        ps: å³ä½¿ä¸ä½¿ç”¨constructorï¼Œreactå†…éƒ¨ä¹Ÿä¼šè‡ªåŠ¨å°†propsæŒ‚è½½åˆ°å®ä¾‹ä¸Šï¼Œç„¶åå¯ä»¥é€šè¿‡this.propsè·å–ä¼ é€’çš„å±æ€§
  
      2.2 åˆå§‹åŒ–çŠ¶æ€(getInitalState)
          ä½œç”¨ï¼šåæœŸä¿®æ”¹å¯ä»¥è§¦å‘è§†å›¾çš„æ›´æ–°ï¼ˆå¯ä»¥å°†éœ€è¦å˜åŒ–çš„å€¼æ”¾å…¥stateä¸­ï¼‰
          éœ€è¦æ‰‹åŠ¨åˆå§‹åŒ–ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰å»åšç›¸å…³çš„å¤„ç†ï¼Œå°±ä¼šè‡ªåŠ¨åœ¨å®ä¾‹ä¸ŠæŒ‚è½½ä¸€ä¸ªnull
          ä¿®æ”¹çŠ¶æ€ï¼š
              1. ï¼ˆé”™è¯¯ï¼‰ç›´æ¥ä¿®æ”¹stateçš„çŠ¶æ€å€¼ä¸ä¼šå¼•èµ·è§†å›¾æ›´æ–°ï¼ˆreactä¸åƒvueä¸€æ ·å¯¹å¯¹è±¡åšåŠ«æŒï¼‰
              2. ï¼ˆæ­£ç¡®ï¼‰ä½¿ç”¨ç»§æ‰¿è‡ªReact.ComponentåŸå‹ä¸Šçš„setState(particalState)æ–¹æ³•è¿›è¡Œæ•°æ®æ›´æ”¹
               @1 particalSateè¡¨ç¤ºéƒ¨åˆ†çŠ¶æ€
              3. ï¼ˆæ­£ç¡®ï¼‰ this.state.xxx = '' this.forceUpdate()å¼ºåˆ¶æ›´æ–°è§†å›¾
  
      2.3 æ‰§è¡Œå‘¨æœŸå‡½æ•°componentWillMount(ä¸å®‰å…¨çš„)
          -- åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“å‰ï¼Œå±æ€§åˆå§‹åŒ–å’ŒçŠ¶æ€åˆå§‹åŒ–ä¹‹åè°ƒç”¨
          -- UNSAFE_componentWillMountå¯ä»¥ä¸è®©è¿™ä¸ªå‡½æ•°å‡ºç°è­¦å‘Š
          -- å¦‚æœå¼€å¯äº†React.StrictMode(reactçš„ä¸¥æ ¼æ¨¡å¼-->æ£€æµ‹reactä¸­çš„ä¸è§„èŒƒè¯­æ³•å’Œä¸å»ºè®®ä½¿ç”¨çš„api)ï¼Œä½¿ç”¨UNSAFE_componentWillMountä¹Ÿä¼šæŠ›å‡ºçº¢è‰²è­¦å‘Š
   
       2.4 æ‰§è¡Œrenderå‡½æ•°
  
       2.5 æ‰§è¡ŒcomponentDidMountï¼Œç¬¬ä¸€æ¬¡æ¸²æŸ“å®Œæ¯•ï¼Œï¼ˆrenderå°±å·²ç»å°†è™šæ‹Ÿdomè½¬æ¢ä¸ºçœŸå®domäº†ï¼‰å¯ä»¥è·å–çœŸå®domäº†
   


```

<div style="color:red">è§£å†³å‡½æ•°ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“è§†å›¾æ— æ³•æ”¹å˜çš„é—®é¢˜</div>

```jsx
class Vote extends React.Component{
    // å±æ€§çš„è§„åˆ™æ ¡éªŒ
    static defaultProps = {
        num:0
    }
    static propTypes = {
        title:PropTypes.string.isRequired,
        num: PropTypes.number.isRequired
    }
    state = { // åˆå§‹åŒ–çŠ¶æ€
        opnum:0,
        agnum:0,
    }
   constructor(props){
        super(props) // ä¼ é€’çš„å±æ€§æŒ‚åœ¨åˆ°thiså®ä¾‹ä¸Š
        console.log(this)
  
   }
    render(){
        console.log("å¼€å§‹æ¸²æŸ“")
        let {title} = this.props  // ->è¿›è¡Œpropsè§£æ„
        let {opnum, agnum} = this.state 
        return (<>
            <div>
                <h2>{title}</h2>
                <div>æ€»äººæ•°{opnum + agnum}</div>
            </div>
            <div>
                <p>åå¯¹äººæ•°ï¼š{agnum}</p>
                <p>æ”¯æŒäººæ•°:{opnum}</p>
            </div>
            <div>
                <button onClick={
                    ()=>{
                        this.setState({
                            opnum: ++opnum
                        })
                    }
                }>åå¯¹ğŸ™…</button>
                <button onClick = {
                    ()=>{
                        // ä¸å»ºè®®ä½¿ç”¨ ï¼Œåº”è¯¥ä½¿ç”¨setStateè¿›è¡Œæ”¹å˜çŠ¶æ€
                        this.state.agnum++
                        this.forceUpdate()
                    }
                }>æ”¯æŒ</button>
            </div>
        </>)
    }
    UNSAFE_componentWillMount(){
        console.log("åˆå§‹åŒ–å®Œæ¯•")
    }
    componentDidMount(){
        console.log("ç¬¬ä¸€æ¬¡æ¸²æŸ“å®Œæ¯•")
    }
  
}
export default Vote;
```

### 8.  ç»„ä»¶æ›´æ–°çš„åº•å±‚é€»è¾‘

```jsx
 1. ç»„ä»¶æ›´æ–°çš„åŸå› ï¼š(ç»„ä»¶å†…éƒ¨çŠ¶æ€æ”¹å˜æˆ–è€…çˆ¶ç»„ä»¶æ”¹å˜ï¼Œéƒ½ä¼šè§¦å‘ç»„ä»¶æ›´æ–°)

 2. æ›´æ–°çš„æµç¨‹
 
  2.1.æ˜¯å¦å…è®¸ç»„ä»¶æ›´æ–°çš„é’©å­ shouldComponentUpdate(nextProps,nextState)

   2.1.1.è¿”å›true ç»„ä»¶æ›´æ–°
   2.1.2.è¿”å›false ç»„ä»¶ä¸æ›´æ–°ï¼ˆä¸è¿›å…¥ä¸‹ä¸€ä¸ªå‘¨æœŸå‡½æ•°ï¼‰ ,ä½†æ˜¯ã€stateé‡Œé¢çš„å€¼æ˜¯æ›´æ”¹äº†çš„ï¼Œå¯ä»¥åšç»Ÿä¸€æ¸²æŸ“ã€‘
   nextProps:ä¸‹ä¸€æ¬¡æ›´æ–°çš„å±æ€§, nextState:ä¸‹ä¸€æ¬¡æ›´æ–°çš„çŠ¶æ€,this.props,this.state,å­˜æ”¾çš„æ˜¯æœ¬æ¬¡æ›´æ–°çš„å±æ€§å’ŒçŠ¶æ€ï¼ˆçŠ¶æ€è¿˜æ²¡æœ‰æ›´æ”¹ï¼‰
  
  2.2.UNSAFE_componentWillUpdate(nextProps,nextState)ã€ä¹Ÿæ˜¯ä¸å®‰å…¨çš„ã€‘
   2.2.1. nextProps:ä¸‹ä¸€æ¬¡æ›´æ–°çš„å±æ€§, nextState:ä¸‹ä¸€æ¬¡æ›´æ–°çš„çŠ¶æ€ï¼Œthis.props,this.state,å­˜æ”¾çš„æ˜¯æœ¬æ¬¡æ›´æ–°çš„å±æ€§å’ŒçŠ¶æ€ï¼ˆçŠ¶æ€æœªä¿®æ”¹ï¼‰
   2.2.2 è¿™ä¸ªå‡½æ•°æ‰§è¡Œå®Œæˆåï¼Œä¼šä¿®æ”¹stateå‡½æ•°ä¸ºnextState
  
  2.3. render() é‡æ–°æ¸²æŸ“ï¼ˆæŒ‰ç…§æœ€æ–°çš„çŠ¶æ€å’Œå±æ€§ç¼–è¯‘ä¸ºvdomï¼‰ï¼Œå’Œç¬¬ä¸€æ¬¡æ¸²æŸ“çš„vdomå¯¹æ¯”ï¼Œå°†å·®å¼‚éƒ¨åˆ†æ¸²æŸ“ä¸ºçœŸå®dom
  
  2.4. componentDidUpdate() ç»„ä»¶æ›´æ–°å®Œæ¯•
  
   ps: å¦‚æœä½¿ç”¨this.forceUpdate() å¼ºåˆ¶æ›´æ–°,ä¸ä¼šè°ƒç”¨shouldComponentUpdate,ä½†æ˜¯ä¼šè°ƒç”¨componentWillUpdateå’ŒcomponentDidUpdateï¼Œè¿™ä¸ªå‡½æ•°ä¸ç®¡vdomæœ‰æ²¡æœ‰å˜åŒ–ï¼Œéƒ½ä¼šé‡æ–°æ¸²æŸ“ç»„ä»¶

3. ç»„ä»¶å¸è½½çš„é€»è¾‘ï¼š
 	 componentWillUnmount() ç»„ä»¶å¸è½½ä¹‹å‰çš„ç”Ÿå‘½å‘¨æœŸ
    + ç»„ä»¶å¸è½½ä¼šé‡Šæ”¾çœŸå®domï¼Œè™šæ‹Ÿdomï¼Œåˆæˆäº‹ä»¶ï¼Œä½†æ˜¯ä¸ä¼šç§»é™¤è‡ªå·±è®¾ç½®çš„å®šæ—¶å™¨ï¼Œç›‘å¬å™¨ï¼Œæ‰‹åŠ¨è®¾ç½®çš„äº‹ä»¶ï¼Œéœ€è¦è‡ªå·±ç§»é™¤
   
4. çˆ¶å­ç»„ä»¶çš„æ›´æ–°é¡ºåºï¼šï¼ˆå’Œvueå·®ä¸å¤šï¼‰
  
   4.1.çˆ¶ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“: çˆ¶ç»„ä»¶ componentWillMount -> render[å­ç»„ä»¶componentWillMount - > å­ç»„ä»¶render -> å­ç»„ä»¶componentDidMount] -> componentDidMount
  
   4.2.çˆ¶ç»„ä»¶æ›´æ–°: çˆ¶ç»„ä»¶ shouldComponentUpdate -> çˆ¶ç»„ä»¶ componentWillUpdate -> render[ å­ç»„ä»¶shouldComponentUpdate -> å­ç»„ä»¶componentWillUpdate -> å­ç»„ä»¶render -> å­ç»„ä»¶componentDidUpdate] -> componentDidUpdate
  
   4.3.å¦‚æœçˆ¶ç»„ä»¶ä¼ é€’propsç»™å­ç»„ä»¶ï¼Œçˆ¶ç»„ä»¶çš„propså‘ç”Ÿæ”¹å˜ï¼šçˆ¶ç»„ä»¶ shouldComponentUpdate -> çˆ¶ç»„ä»¶ componentWillUpdate -> render[å­ç»„ä»¶componentWillReceiveProp --> å­ç»„ä»¶shouldComponentUpdate -> å­ç»„ä»¶componentWillUpdate -> å­ç»„ä»¶render -> å­ç»„ä»¶componentDidUpdate] -> componentDidUpdate
   UNSAFE_componentWillReceiveProp() --> è¿™ä¸ªå‘¨æœŸå‡½æ•°ç»“æŸåï¼Œä¼šå°†æœ€æ–°çš„propsä¼ é€’ç»™å­ç»„ä»¶
  
   4.4. çˆ¶ç»„ä»¶é”€æ¯ï¼šçˆ¶ç»„ä»¶componentWillUnmount -> å­ç»„ä»¶componentWillUnmount -> å­ç»„ä»¶é”€æ¯ -> çˆ¶ç»„ä»¶é”€æ¯

```

### 9. pureComponent

#### 9.1.å¯¹è±¡è§£æ„å †æ ˆåœ°å€çš„å˜åŒ–

```jsx
å¯¹è±¡è§£æ„èµ‹å€¼çš„çŸ¥è¯†ç‚¹ï¼šå¯¹äºè§£æ„åçš„å€¼ä¸ºåŸºæœ¬ç±»å‹çš„æ”¹å˜ä¸ä¼šå½±å“åŸæ¥çš„å¯¹è±¡ï¼Œå¦‚æœè§£æ„åçš„å€¼ä¸ºå¯¹è±¡ç±»å‹ï¼Œè§£æ„åçš„å€¼æ›´æ”¹ä¹Ÿä¼šæ”¹å˜åŸæ¥å¯¹è±¡çš„å€¼
/**
 * å¯¹è±¡çš„è§£æ„èµ‹å€¼çš„ä¸åŒæƒ…å†µ
 *  // æ ˆåœ°å€
 *   let a = {l:1,o:2}
     let {l,o} = a
     k=3
     o=4
     a //{l: 1, o: 2}

     // å †åœ°å€
     let a = {l:[1,2,3,4],o:{v:0,k:1}}
     let {l,o} = a
        l.push(5)
        o.v=2
        a //{l: [1, 2, 3, 4, 5], o: {v: 2, k: 1}}
 * 
 */

// æ‰€ä»¥å¯¹è§£æ„åçš„stateçš„å¯¹è±¡å€¼ä¿®æ”¹ï¼Œä¹Ÿä¼šä¿®æ”¹stateå¯¹è±¡çš„å€¼

 state = {
        arr: [10,20,30]
    }
    render(){
        let {arr} = this.state;
        return (<>
            {
                arr.map((item,index)=>{
                    return <span key={index} style={{display:'inline-block',width:100,height:100,marginRight:10,background:'pink'}}>{item}</span>
                })
            }
            <button onClick={()=>{
                arr.push(40); // çŠ¶æ€æ›´æ”¹ï¼Œå› ä¸ºè¿™é‡Œçš„è§£æ„ä¹‹åç”¨çš„è¿˜æ˜¯ä¸€å—åœ°å€
                this.setState({ // è§¦å‘è§†å›¾æ›´æ–°
                    arr
                })
            }}>add</button>
            </>)
    }
```

#### 9.2.æµ…æ¯”è¾ƒçš„æ–¹æ³•

```jsx
// å¯¹è±¡æµ…æ¯”è¾ƒçš„æ–¹æ³•
const shallowEqual = (obj1,obj2)=>{
    if(obj1 === obj2){
        return true;
    }
    if(typeof obj1 !== "function" || typeof obj2 !== "function"){
        if(typeof obj1 !== 'object' || obj1 === null || typeof obj2 !== 'object' || obj2 === null){
            return false;
        }
    }
    let keys1 = Reflect.ownKeys(obj1);
    let keys2 = Reflect.ownKeys(obj2);
    if(keys1.length !== keys2.length){
        return false;
    }
    for(let key of keys1){ // Object.isåˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦ä¸¥æ ¼ç›¸ç­‰ï¼Œå°±æ˜¯ä¼šåˆ¤æ–­è¿™ä¸¤ä¸ªå€¼çš„åœ°å€æ˜¯å¦ç›¸ç­‰ï¼Œè¿™ä¸€æ­¥æ˜¯å¾ˆå…³é”®çš„
        if(!obj2.hasOwnProperty(key) || !Object.is(obj1[key],obj2[key])){
            return false;
        }
    }
    return true;
}
let a = {a:1,b:2};
console.log(shallowEqual({b:[1,2]},{b:[1,2]})) //  false
console.log(shallowEqual(a,a)) // true



```

#### 9.3.pureComponentç»„ä»¶çš„åŸç†

```jsx
/**
 * PureComponentå’Œcomponentçš„åŒºåˆ«ï¼šPureComponentä¼šè‡ªåŠ¨ç»™ç±»ç»„ä»¶åŠ ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼ˆshouldComponentUpdateï¼‰,è‡ªå·±ä¸éœ€è¦å†™
 * + å‘¨æœŸå‡½æ•°ä¼šå¯¹æ–°è€çš„å±æ€§å’ŒçŠ¶æ€è¿›è¡Œæµ…æ¯”è¾ƒï¼Œå¦‚æœç›¸åŒï¼ˆå±æ€§å’ŒçŠ¶æ€ï¼‰ return falseï¼Œä¸ä¼šé‡æ–°æ¸²æŸ“ï¼Œå¦‚æœä¸åŒ return trueï¼Œæ‰ä¼šé‡æ–°æ¸²æŸ“
 *  ä»€ä¹ˆæ˜¯æµ…æ¯”è¾ƒï¼šåªæ¯”è¾ƒå¯¹è±¡çš„ç¬¬ä¸€çº§ï¼Œå¯¹äºæ·±å±‚æ¬¡çš„å†…å®¹ä¸ä¼šè¿›è¡Œæ¯”è¾ƒï¼Œ1.æ¯”è¾ƒå¯¹è±¡æ•°é‡ï¼Œ2.å¯¹è±¡åªæ¯”è¾ƒåœ°å€ï¼Œåœ°å€ç›¸åŒå°±ä¼šè®¤ä¸ºæ˜¯ç›¸åŒçš„ï¼Œ3.å…¶ä»–ç±»å‹æ¯”è¾ƒå€¼æ˜¯å¦ä¸€æ ·
 * 
 */
class Demo2 extends React.PureComponent{

    state = {
        arr: [10,20,30]
    }
    render(){
        let {arr} = this.state;
        return (<>
            {
                arr.map((item,index)=>{
                    return <span key={index} style={{display:'inline-block',width:100,height:100,marginRight:10,background:'pink'}}>{item}</span>
                })
            }
            <button onClick={()=>{
                arr.push(40); // çŠ¶æ€æ›´æ”¹ï¼Œè¿™é‡Œçš„è§£æ„ä¹‹åç”¨çš„è¿˜æ˜¯ä¸€å—åœ°å€
                this.setState({ // (PureComponentä¸­è¿™é‡Œæ²¡æœ‰èµ·ä½œç”¨ï¼Œè¿›è¡Œäº†æµ…æ¯”è¾ƒï¼Œåœ°å€ä¸€æ ·ï¼ŒcomponentShouldUpdateè¿”å›falseï¼Œä¸ä¼šé‡æ–°æ¸²æŸ“)
                    arr
                })
            }}>add</button>
            </>)
	}
}
```

#### 9.4 ä½¿ç”¨componentå®ç°pureComponentç»„ä»¶

```jsx
class Demo2 extends React.Component{
	shouldComponentUpdate(nextProps,nextState){ // pureComponentè‡ªå¸¦çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°
    let {props, state} = this
		return !shallowEqual(props,nextProps) || !shallowEqual(state,nextState)
	}
}
```

#### 9.5. è§£å†³9.3PureComponentçŠ¶æ€å€¼æ”¹å˜ï¼Œè§†å›¾æ— æ³•æ›´æ–°çš„é—®é¢˜

```jsx
// æ–¹æ³•ä¸€
<button onClick={()=>{
                arr.push(40); 
                this.setState({ 
                    arr : [...arr]  // æ”¹ä¸ºä¸€ä¸ªæ–°çš„æ•°ç»„åœ°å€ï¼Œåšæµ…æ¯”è¾ƒå°±ä¼šç—›æ®´
                })
            }}>add</button>

// æ–¹æ³•äºŒ
<button onClick={()=>{
                arr.push(40); 
                this.setState({ 
                    arr
                })
   						 this.forceUpdate() // å¼ºåˆ¶æ›´æ–°ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šè·³è¿‡shouldComponentUpdate
            }}>add</button>

```

### 10. refè·å–å…ƒç´ å’Œç»„ä»¶å®ä¾‹

```js
/**
  refæ“ä½œï¼š
  
  å—æ§ç»„ä»¶ï¼šä¿®æ”¹æ•°æ®ï¼Œè®©è§†å›¾æ›´æ–°
  éå—æ§ç»„ä»¶ï¼šæ“ä½œdomå…ƒç´ ï¼Œè®©è§†å›¾æ›´æ–°
  
  ï¼ˆ1ï¼‰refè·å–domå…ƒç´ 
  æ–¹æ¡ˆä¸€ï¼š
   1. ç»™éœ€è¦è·å–çš„domå…ƒç´ æ·»åŠ refå±æ€§
   2. åœ¨ç»„ä»¶ä¸­é€šè¿‡this.refs.xxxè·å–domå…ƒç´ 
  
   æ³¨æ„ï¼šthis.refs.xxxä¸æ¨èä½¿ç”¨äº†
  
  æ–¹æ¡ˆäºŒï¼šä½¿ç”¨å‡½æ•°
    1. <h2 ref={ x=> this.box2 = x }>ä½¿ç”¨å‡½æ•°</h2>
    2. åœ¨ç»„ä»¶ä¸­é€šè¿‡this.box2è·å–domå…ƒç´ 
  
    åŸå› ï¼šReact.createElementæ‰§è¡Œç”Ÿæˆçš„è™šæ‹Ÿdomå¯¹è±¡ï¼Œä¼šç»™refå±æ€§çš„æ ‡ç­¾å…ƒç´ æ·»åŠ ä¸€ä¸ªå±æ€§ï¼šref={xxx}ï¼Œ
     1.åœ¨renderçš„æ—¶å€™ï¼Œä¼šè·å–vdomçš„refå±æ€§ï¼Œå¦‚æœæ˜¯å­—ç¬¦ä¸²ï¼Œå°±ä¼šç»™this.refsæ·»åŠ ä¸€ä¸ªå½“å‰çš„domå…ƒç´ ï¼Œ
     2.å¦‚æœæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå°±ä¼šæ‰§è¡Œè¿™ä¸ªå‡½æ•°ï¼Œå¹¶ä¸”æŠŠå½“å‰çš„domå…ƒç´ ä¼ é€’ç»™è¿™ä¸ªå‡½æ•°ï¼Œåœ¨å‡½æ•°çš„å†…éƒ¨ï¼Œ
     å°±æŠŠè¿™ä¸ªdomå…ƒç´ èµ‹å€¼ç»™å½“å‰å®ä¾‹çš„æŸä¸ªå±æ€§
  
   æ–¹æ¡ˆä¸‰ï¼šä½¿ç”¨React.createRef()
     1. åœ¨constructorä¸­åˆ›å»ºä¸€ä¸ªrefå¯¹è±¡ï¼šthis.box3 = React.createRef() ==ã€‹{current: null}
     2. åœ¨refä¸­æŒ‡å‘è¿™ä¸ªå¯¹è±¡ï¼š <h2 ref={ this.box3 }>ä½¿ç”¨React.createRef()</h2>
     3. åœ¨ç»„ä»¶ä¸­é€šè¿‡this.box3.currentè·å–domå…ƒç´ 
  
  
   ï¼ˆ2ï¼‰refå¦‚æœèµ‹å€¼ç»™ç»„ä»¶æ˜¯å¹²å˜›çš„ï¼Ÿ
  
    1. ç»™ç±»ç»„ä»¶è®¾ç½®refå±æ€§ï¼Œå¯ä»¥è·å–ç»„ä»¶å®ä¾‹ï¼Œæ¯”å¦‚å¯ä»¥æ‹¿åˆ°stateå’Œrefä»¥åŠå…¶å­ç»„ä»¶çš„æ–¹æ³•ç­‰ç­‰
    2. ç›´æ¥ç»™å‡½æ•°ç»„ä»¶è®¾ç½®refå±æ€§ï¼šæŠ¥é”™ï¼Œå‡½æ•°ç»„ä»¶ä¸èƒ½è®¾ç½®refå±æ€§
    3. å¦‚ä½•ç»™å‡½æ•°ç»„ä»¶æ­£ç¡®è®¾ç½®refï¼šï¼ˆå‡½æ•°ç»„ä»¶çš„refä¼šè·å–å‡½æ•°å†…éƒ¨çš„æŸä¸ªå…ƒç´ å€¼ï¼‰
         3.1 ä½¿ç”¨React.forwardRef()åŒ…è£¹å‡½æ•°ç»„ä»¶ï¼Œ
         3.2 è¿™ä¸ªæ—¶å€™å‡½æ•°ç»„ä»¶ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥è·å¾—ä¸€ä¸ªä¼ é€’è¿‡æ¥çš„refçš„å€¼ï¼Œè¿™ä¸ªå€¼å°±æ˜¯çˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„ref {x=> this.child1 = x}
         3.3 å°†è¿™ä¸ªå€¼é€šè¿‡refç»‘å®šåˆ°å‡½æ•°ç»„ä»¶å†…éƒ¨çš„æŸä¸ªå…ƒç´ ä¸Šï¼Œå°±å¯ä»¥åœ¨çˆ¶ç»„ä»¶è·å–åˆ°å‡½æ•°ç»„ä»¶çš„è¿™ä¸ªå…ƒç´ 
    4. è·å–ç±»ç»„ä»¶çš„æŸä¸ªå…ƒç´ ï¼Œåœ¨ç±»ç»„ä»¶å…ƒç´ ä¸­è®¾ç½®refå±æ€§ï¼Œç„¶åé€šè¿‡ç»„ä»¶å®ä¾‹è·å–refsæ‹¿åˆ°å…ƒç´ ,æˆ–è€…å…¶ä»–currentç­‰
  
   
 */
```

```jsx
// æ¡ˆä¾‹
class Demo2 extends React.PureComponent{
    box3 = React.createRef()
    render(){
        return (<>
                <div>
                    <h2 className="title" ref="titleBox">title(demo2)</h2>
                    <h2 ref={ x=> this.box2 = x }>ä½¿ç”¨å‡½æ•°(demo2)</h2>
                    <h2 ref={ this.box3 }>ä½¿ç”¨React.createRef(demo2)</h2>
                </div>
            </>)
    }
    componentDidMount(){ // renderå®Œæˆï¼Œå¯ä»¥è·å–domå…ƒç´ 
  
        // console.log(this.refs.titleBox)
        // console.log(this.box2)
        // console.log(this.box3.current)
    }
}
const Demo1 = React.forwardRef(function Demo1(props,ref){ // refç›¸å½“äºref={x => this.child1 = x}
    console.log("å‡½æ•°ç»„ä»¶",ref)
    return (<>
        demo1(å‡½æ•°ç»„ä»¶)
        <h1 ref={ref}>å‡½æ•°ç»„ä»¶ref</h1>
    </>)
})


export default class Demo3 extends React.PureComponent{
  
    render(){
        return (<>
            <Demo1 ref={x => this.child1 = x}></Demo1>
            <Demo2 ref={x => this.child2 = x}></Demo2>
   
        </>) 
    }
    componentDidMount(){
        console.log("å‡½æ•°ç»„ä»¶",this.child1) // --> å‡½æ•°ç»„ä»¶ä¸èƒ½ç›´æ¥è®¾ç½®refå±æ€§
        console.log("å¯¹è±¡ç»„ä»¶",this.child2) // --> ç±»ç»„ä»¶å¯ä»¥æ‹¿åˆ°ç»„ä»¶å®ä¾‹

    }
}

```

### 11. setState

#### 11.1. setStateçš„åŸºæœ¬è¯­æ³•

```js

 1. this.setState(particalState, callback)) çš„åŸºæœ¬è¯­æ³•
 
   1.1 particalState:éƒ¨åˆ†çŠ¶æ€,æ˜¯ä¸€ä¸ªå¯¹è±¡(æ”¯æŒéƒ¨åˆ†çŠ¶æ€çš„æ›´æ”¹) 
   1.2 callback:å›è°ƒå‡½æ•° --> åœ¨çŠ¶æ€æ›´æ”¹ï¼Œï¼ˆrenderï¼‰è§†å›¾æ›´æ–°å®Œæ¯•åè¿›è¡Œæ‰§è¡Œï¼Œ
      å‘ç”Ÿåœ¨componenntDidUpdateä¹‹åï¼ŒcomponentDidUpdateä¼šåœ¨ä»»ä½•çŠ¶æ€
      æ›´æ–°å®Œæ¯•éƒ½ä¼šæ‰§è¡Œï¼Œä½†æ˜¯callbackä¹Ÿå¯ä»¥åœ¨çŠ¶æ€æ›´æ–°å®Œæ¯•åšä¸€äº›äº‹æƒ…
    1.3 å³ä¾¿shouldCommponentUpdateè¿”å›falseï¼Œä¸ä¼šæ‰§è¡ŒcomponentDidUpdateï¼Œä½†æ˜¯callbackä¾ç„¶ä¼šè¢«è§¦å‘æ‰§è¡Œ
    ç±»ä¼¼äºvueä¸­çš„$nextTick(éƒ½èƒ½ç¡®ä¿è§†å›¾æ›´æ–°å®Œæ¯•)
	   this.setState({
            x:x+1
        },()=>{
            console.log("æ›´æ–°å®Œæ¯•x")
        })

	1.4.æ¯”å¦‚ä½ æ·»åŠ äº†æ•°æ®ï¼Œè¿™ä¸ªæ—¶å€™ä½ æ“ä½œdomï¼Œä½†æ˜¯ä½ ä¸èƒ½ç¡®å®šdom renderå®Œæ¯•ï¼Œä½ å°±å¯ä»¥å†™åœ¨callbackå‡½æ•°ä¸­
```

#### 11.2. setStateå¼‚æ­¥æ›´æ–°çš„åŸç†

```jsx

    2.setStateå¼‚æ­¥æ›´æ–°
  
        2.1 this.setStateä¿®æ”¹å¤šä¸ªçŠ¶æ€ä¹Ÿåªä¼šæ›´æ–°ä¸€æ¬¡è§†å›¾ this.setState({ x:x+1,y:y+1,z:z+1}
            è¿ç»­è°ƒç”¨this.setState({x:x+1}) this.setState({y:y+1}) this.setState({y:y+1})ï¼Œä¹Ÿåªä¼šè§¦å‘ä¸€æ¬¡è§†å›¾æ›´æ–°

        2.2 å¤šæ¬¡è°ƒç”¨éƒ½åªè§¦å‘ä¸€æ¬¡ï¼Œè¯´æ˜setStateæ˜¯å¼‚æ­¥çš„ï¼Œreactä¼šå°†å¤šæ¬¡è°ƒç”¨åˆå¹¶æˆä¸€æ¬¡ï¼Œå‡å°‘è§†å›¾æ›´æ–°æ¬¡æ•°ï¼Œæé«˜æ€§èƒ½

        2.3 reactä¸­setStateåœ¨ä»»ä½•åœ°æ–¹æ‰§è¡Œï¼ˆåˆæˆæ—¶é—´ï¼Œå‘¨æœŸå‡½æ•°ï¼Œå®šæ—¶å™¨ï¼‰éƒ½æ˜¯å¼‚æ­¥æ“ä½œï¼ŒåŸºäºå¼‚æ­¥æ“ä½œå®ç°æ‰¹å¤„ç†ï¼ˆreactä¸­çš„å¼‚æ­¥é˜Ÿåˆ—ï¼‰ï¼Œå¥½å¤„ï¼šå‡å°‘è§†å›¾æ›´æ–°ï¼Œæå‡æ€§èƒ½ï¼Œæœ‰æ•ˆç®¡ç†ä»£ç æ‰§è¡Œçš„é€»è¾‘é¡ºåº
        2.4 åŸç†ï¼šåˆ©ç”¨äº†updatoræ›´æ–°é˜Ÿåˆ—æ¥å®Œæˆçš„ 
        		+ åœ¨å½“å‰çš„ç›¸åŒçš„æ—¶é—´ç«¯ä¹‹å†…ï¼Œå°†setStateæ”¾å…¥åˆ°updatorä¸­ï¼Œå½“æ‰€æœ‰çš„åŒæ­¥ä»£ç æ‰§è¡Œå®Œæˆåï¼Œé€šçŸ¥updatoræ‰§è¡Œï¼Œåˆå¹¶stateæ”¹å˜çŠ¶æ€è¿›è¡Œæ¸²æŸ“
						+ ç„¶åå¼‚æ­¥ä»£ç ä¸­çš„setStateæ”¾å…¥updatorï¼ŒæŒ‰ç…§æ—¶é—´é¡ºåºä¾æ¬¡æ‰§è¡Œï¼Œæ—¶é—´ä¸åŒå¯èƒ½ä¼šä¿ƒå‘å¤šæ¬¡æ¸²æŸ“
						+ updatorä¸æ˜¯ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„å®ä»»åŠ¡
```

<img src="image/3.reactç»„ä»¶/1692110693731.png" alt="1692110693731" style="zoom:67%;" />

#### 11.3. å½“ç»„ä»¶ä¸­å‡ºç°ä¸€ä¸ªå¼‚æ­¥æ›´æ–°stateæ—¶å€™setStateçš„å¤„ç†æ–¹å¼

```jsx
 
// è§†å›¾æ›´æ–°ä¸¤æ¬¡
handle = ()=>{ 
        let {x,y,z} = this.state;
        this.setState({x:x+1})
        this.setState({y:y+1})
        console.log(this.state) // {10,5,0}
        setTimeout(()=>{
            this.setState({z:z+1}) //æ‰§è¡Œthis.renderåæ‹¿åˆ° {11,6,0}
            console.log(this.state)
        }
        ,1000)
    }
```

![1692111468956](image/3.reactç»„ä»¶/1692111468956.png)

#### 11.4. å½“ç»„ä»¶ä¸­å‡ºç°å¤šä¸ªå¼‚æ­¥ä»£ç æ›´æ–°stateæ—¶ï¼ŒsetStateçš„å¤„ç†æ–¹å¼

```jsx
// è§†å›¾æ›´æ–°ä¸€æ¬¡ åŒæ—¶é—´çš„stateä¼šåˆå¹¶æ›´æ–°ä¸€æ¬¡ï¼ˆæ—¶é—´æ®µç›¸åŒï¼‰
setTimeout(()=>{
            this.setState({x:x+1})
            console.log(this.state)  // {10,5,0}
        }
        ,1000)
        setTimeout(()=>{
            this.setState({y:y+1})
            console.log(this.state)  // {10,5,0}
        }
        ,1000)
        setTimeout(()=>{
            this.setState({z:z+1})
            console.log(this.state)  // {10,5,0}
        }
        ,1000)


```

```jsx
// è§†å›¾æ›´æ–°ä¸‰æ¬¡(æ—¶é—´æ®µä¸åŒ)
setTimeout(()=>{
            this.setState({x:x+1})
            console.log(this.state)  // {10,6,0}
        }
        ,2000)
        setTimeout(()=>{
            this.setState({y:y+1})
            console.log(this.state)  // {10,5,0}
        }
        ,1000)
        setTimeout(()=>{
            this.setState({z:z+1})
            console.log(this.state)  // {11,6,0}
        }
        ,3000)
```

#### 11.5 setState react16

```jsx
1.åŒºåˆ«ï¼š
	1.1 react18æ— è®ºåœ¨ä»€ä¹ˆåœ°æ–¹æ‰§è¡Œsetstateéƒ½æ˜¯å¼‚æ­¥çš„
  1.2 react16ä¸­åœ¨åˆæˆäº‹ä»¶å’Œå‘¨æœŸå‡½æ•°ä¸­ï¼ŒsetStateæ˜¯å¼‚æ­¥çš„ï¼Œå¦‚æœsetStateå‡ºç°åœ¨å…¶ä»–å¼‚æ­¥æ“ä½œä¸­ï¼ˆå®šæ—¶å™¨ï¼Œæˆ–è€…æ‰‹åŠ¨è·å–domå…ƒç´ è¿›è¡Œæ—¶é—´ç»‘å®šã€å…ƒç´ .addeventã€‘ï¼‰,ä»–å°†å˜æˆåŒæ­¥æ“ä½œã€ç«‹å³æ›´æ–°çŠ¶æ€è¿›è¡Œè§†å›¾æ¸²æŸ“ã€‘ ä¸€ä¸ªå…ˆè¾“å‡ºå†æ¸²æŸ“ï¼ˆ18ï¼‰ï¼Œä¸€ä¸ªå…ˆæ¸²æŸ“å†è¾“å‡ºï¼ˆ16ï¼‰
 

  

```

<div style="color:red">react16æ¸²æŸ“æœºåˆ¶</div>

<img src="image/3.reactç»„ä»¶/1692115162090.png" alt="1692115162090" style="zoom: 50%;" />

#### 11.6. flushSync

```jsx
import {flushSync} feom "react-dom" 
// è§†å›¾æ›´æ–°ä¸¤æ¬¡   
handle = ()=>{
        let {x,y,z} = this.state;
        this.setState({x:x+1})
        console.log("1",this.state) // {x: 10, y: 5, z: 0}
        flushSync(()=>{
            this.setState({y:y+1})
            console.log("2",this.state) // {x: 10, y: 5, z: 0}
        })
        console.log("3",this.state) // {x: 11, y: 6, z: 0}
        this.setState({z:z+1})
   
    }
```

```
 handle = ()=>{ // ç®­å¤´å‡½æ•°çš„thisæ°¸è¿œæŒ‡å‘ç»„ä»¶å®ä¾‹
        let {x,y,z} = this.state;
        this.setState({x:x+1})
        console.log("1",this.state) // {x: 10, y: 5, z: 0}
        flushSync(()=>{
            this.setState({y:y+1})
            console.log("2",this.state) // {x: 10, y: 5, z: 0}
        })
        console.log("3",this.state) // {x: 11, y: 6, z: 0}
        this.setState({z: this.state.x+ this.state.y})
   
    }
```

<div style="color:red">flushSyncçš„å¤„ç†é€»è¾‘ï¼Œè¿™é‡Œå¯ä»¥æ”¹å˜å¼‚æ­¥æ“ä½œçš„æ‰¹å¤„ç†æ–¹å¼ï¼Œæ¯”å¦‚è¿™é‡Œè®©xå’Œyæ”¹å˜åï¼Œèµ‹å€¼ç»™xçš„éœ€æ±‚</div>

<img src="image/3.reactç»„ä»¶/1692150928226.png" alt="1692150928226" style="zoom:67%;" />

<div style="color:red">flushSync   forå¾ªç¯</div>

```jsx



// è§†å›¾æ‰§è¡Œä¸€æ¬¡ï¼Œxç»“æœä¸º10

// stateçš„çŠ¶æ€æ”¹å˜æ˜¯åœ¨componentwillupdateä¹‹åï¼Œå› ä¸ºè¿™é‡Œåˆæˆä¸€ä¸ªå»updatorï¼Œåªèƒ½æ‹¿åˆ°åŸå§‹çš„state.xå€¼
for(let i =0 ;i<20; i++){
	this.setState({
		x:this.state.x +1 // 
	})
}

// è§†å›¾æ‰§è¡Œ20æ¬¡ï¼Œxç»“æœä¸º30
// æ¯é‡åˆ°ä¸€æ¬¡flushSyncå°±ä¼šåˆ·æ–°ä¸€æ¬¡è§†å›¾
for(let i =0 ;i<20; i++){
  flushSync(()=>{
    	this.setState({
				x:this.state.x+1 
			})
  	})
}

 // xç»“æœä¸º30ï¼Œä½†æ˜¯è§†å›¾æ›´æ–°åªæœ‰ä¸€æ¬¡ï¼ˆsetStateå‡½æ•°å¿ƒæ€ï¼‰
 		for(let i =0 ;i<20; i++){
                  this.setState((preState)=>{ // ä¸Šä¸€ä¸ªçŠ¶æ€å€¼
                        return { // æƒ³è¦ä¿®æ”¹çš„æ–°çš„çŠ¶æ€å€¼ï¼ˆæ”¯æŒä¿®æ”¹éƒ¨åˆ†çŠ¶æ€ï¼‰
                            x: preState.x + 1
                        }
                  })
          }
```

<div style="color:red">setStateå‡½æ•°å½¢æ€</div>

<img src="image/3.reactç»„ä»¶/1692154605277.png" alt="1692154605277" style="zoom:50%;" />

#### 11.7. setStateçš„ç¼ºç‚¹

```
ä¸åŒæ—¶é—´ç«¯çš„setstateä¼šè§¦å‘è§†å›¾æ¸²æŸ“ï¼Œå½“ä¸¤æ¬¡ä¸€æ ·çš„å€¼æ—¶å€™ï¼Œåªæ˜¯æ—¶é—´æ®µä¸ä¸€æ ·ï¼Œè¿˜æ˜¯ä¼šä¿ƒå‘æ›´æ–°ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨pureComponentï¼Œä¼šå°†stateçš„å€¼æµ…æ¯”è¾ƒï¼Œä¸€æ ·çš„å°±ä¸ä¼šæ›´æ–°äº†ï¼Œä½†æ˜¯æœ‰äº›æ—¶å€™å¯¹è±¡é‡Œçš„å€¼è¿›è¡Œäº†å˜åŒ–äº†ï¼Œæµ…æ¯”è¾ƒæ¯”è¾ƒä¸å‡ºæ¥æ— æ³•æ›´æ–°ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥åšèº«æ¯”è¾ƒ
```

### 12. useState

#### 12.1. ä¸ºä»€ä¹ˆä½¿ç”¨useState

```js
  + å‡½æ•°ç»„ä»¶å¦‚ä½•åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“åï¼Œæ— æ³•å†æ¬¡æ¸²æŸ“
  + useStateç›¸å½“äºç±»ç»„ä»¶çš„stateï¼Œå¯ä»¥é€šè¿‡useStateæ¥å®šä¹‰ä¸€ä¸ªçŠ¶æ€ï¼Œæ”¹å˜çŠ¶æ€çš„å€¼ï¼Œç»„ä»¶ä¼šé‡æ–°æ¸²æŸ“
   ps: å‡½æ•°ç»„ä»¶[hook]æ²¡æœ‰å®ä¾‹çš„æ¦‚å¿µï¼Œã€è°ƒç”¨ç»„ä»¶ä¸æ˜¯åˆ›å»ºå®ä¾‹ï¼Œè€Œæ˜¯æ‰§è¡Œå‡½æ•°ï¼Œäº§ç”Ÿä¸€ä¸ªç§æœ‰çš„ä¸Šä¸‹æ–‡ï¼Œæ²¡æœ‰thisçš„å¤„ç†ã€‘
 
```

#### 12.2. useStateçš„ä½¿ç”¨

```jsx
  1.useState(initalState)çš„ä½¿ç”¨
   + initalState:åˆå§‹çŠ¶æ€
   + å…¶è¿”å›å€¼æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„çš„ç¬¬ä¸€é¡¹æ˜¯çŠ¶æ€ï¼Œç¬¬äºŒé¡¹æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥æ”¹å˜çŠ¶æ€
          æ¯”å¦‚ï¼šlet [num,setNum] = useState(0);
   + 0æ˜¯numçš„çŠ¶æ€å€¼ï¼ŒsetNumæ˜¯æ”¹å˜numçš„çŠ¶æ€å€¼çš„å‡½æ•°
   + æ‰§è¡ŒsetNum(1)åï¼ŒNumçš„çŠ¶æ€å€¼å˜ä¸º1ï¼Œç»„ä»¶ä¼šé‡æ–°æ¸²æŸ“
   
    function Demo(props){
      const [num,setNum] = useState(0);
      const handle = ()=>{
          setNum(num+1);
      }
      return (<div>
          <div>num:{num}</div>
          <button onClick={handle}>demo</button>
      </div>)

  }
```

#### 12.3.  hookæ›´æ–°çš„æœºåˆ¶ï¼š

```js
  + æ¯ä¸€æ¬¡æ›´æ–°ï¼Œéƒ½ä¼šé‡æ–°æ‰§è¡Œå‡½æ•°ç»„ä»¶ï¼ˆäº§ç”Ÿä¸€ä¸ª/*å…¨æ–°*/çš„ç§æœ‰ä¸Šä¸‹æ–‡ï¼Œå†…éƒ¨çš„ä»£ç éƒ½ä¼šé‡æ–°æ‰§è¡Œï¼‰
  + æ¯ä¸€æ¬¡æ‰§è¡Œå‡½æ•°ï¼Œä¹Ÿä¼šæŠŠuseStateé‡æ–°æ‰§è¡Œï¼Œä½†æ˜¯
	+ æ‰§è¡ŒuseStateï¼Œåªæœ‰åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„æ—¶å€™è®¾ç½®çš„useStateåˆå§‹å€¼ä¼šè§¦å‘ã€‚ç¬¬ä¸€æ¬¡ä¹‹åçš„æ¸²æŸ“ï¼ˆæ‰§è¡Œï¼‰ï¼Œæ‰§è¡Œçš„useStateéƒ½ä¸æ˜¯åˆå§‹å€¼ï¼Œè€Œæ˜¯æœ€æ–°çš„å€¼ï¼ŒuseStateè¿”å›çš„çŠ¶æ€æ–¹æ³•ä¹Ÿæ˜¯æœ€æ–°çš„
 /*ps:æ¯æ¬¡ä½¿ç”¨useStateå‡½æ•°æ›´æ–°å€¼ï¼Œä¸æ˜¯ä¿®æ”¹å½“å‰ä¸Šä¸‹æ–‡çš„å€¼ï¼Œæ˜¯ç”Ÿæˆä¸€ä¸ªå…¨æ–°çš„ä¸Šä¸‹æ–‡ï¼Œæ‰€ä»¥åˆæˆäº‹ä»¶å‡½æ•°ï¼Œæ‹¿ä¸åˆ°ä¿®æ”¹åçš„çŠ¶æ€å€¼ï¼Œåªèƒ½æ‹¿åˆ°å½“å‰ä¸Šä¸‹æ–‡çš„å€¼,è¿™ä¸ªå€¼åªæ˜¯å½“å‰ä¸Šä¸‹æ–‡çš„å˜é‡ï¼Œå¦‚æœä½ ä½¿ç”¨flushSyncæ›´æ–°ä½ è™½ç„¶æ‹¿ä¸åˆ°ä¸Šä¸‹æ–‡çš„å˜é‡å€¼ï¼Œä½†æ˜¯ä½ å¯ä»¥æ‹¿åˆ°æœ€æ–°çš„domå€¼*

```

<div style='color:red'>ç»„ä»¶æ›´æ–°çš„å¤§æ¦‚æºç </div>

<img src="image/3.reactç»„ä»¶/1692333655342.png" alt="1692333655342" style="zoom:50%;" />

<div style="color:red">useStateçš„å¤§æ¦‚ä»£ç åŸç†</div>

![1692334693143](image/3.reactç»„ä»¶/1692334693143.png)

#### 12.4. å¼‚æ­¥ä¸­çš„useState

å¼‚æ­¥ä¸­çš„stateçš„å€¼ï¼Œæ˜¯å½“å‰ä¸Šä¸‹æ–‡çš„å€¼ï¼Œä¸æ˜¯ä¿®æ”¹åçš„å€¼ï¼Œ    å› ä¸ºæ¯ä¸€æ¬¡æ‰§è¡Œusestateårenderåéƒ½ä¼šå½¢æˆä¸€ä¸ªå…¨æ–°çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå½“å‰ä¸Šä¸‹æ–‡çš„stateçš„å€¼æ˜¯æ²¡æœ‰æ”¹å˜çš„ï¼Œæ‹¿åˆ°çš„å€¼æ˜¯å½“å‰ä¸Šä¸‹æ–‡çš„

<img src="image/3.reactç»„ä»¶/1692335510541.png" alt="1692335510541" style="zoom:50%;" />

#### 12.5.å¤šä¸ªuseStateçŠ¶æ€å¦‚ä½•å¤„ç†

```jsx
// ä¸åƒç±»ç»„ä»¶ä¸­çš„setStateï¼Œä¸æ”¯æŒéƒ¨åˆ†å±æ€§æ›´æ”¹
    setState({
      supNum:state.supNum + 1 // è¿™æ ·oopçš„å€¼å°±æˆä¸ºundefinedäº†
    });


// è§£å†³1ï¼š

		setState({
                ...state,
                supNum:state.supNum + 1 // è¿™é‡Œç›¸å½“äºå¯¹è±¡çš„å±æ€§é‡è½½
            });

// è§£å†³äºŒï¼š

		å®˜æ–¹å»ºè®®ï¼šï¼šéœ€è¦å¤šä¸ªçŠ¶æ€å°±æŠŠuseStateæ‰§è¡Œå¤šæ¬¡
		let [opp,seOpp] = useState(0)
		let [sup,setSup] = useState(0)
  
// ------------------------------------ä»£ç --------------------------------

 function Vote(props) {
    let [state,setState]=useState({ // é›†ä¸­å¤„ç†
        supNum:0,
        oppNum:0
    });
    function handle(value) {
        if(value==='sup'){
            setState({
                ...state,
                supNum:state.supNum + 1 // è¿™é‡Œç›¸å½“äºå¯¹è±¡çš„å±æ€§é‡è½½
            });
        }else{
            setState({
                ...state,
                oppNum: state.oppNum + 1
            });
        }
    }
    let {supNum,oppNum}=state;
    return <div className="vote-box">
      <div className="header">
        <h2 className="title">{props.title}</h2>
        <span>{supNum+oppNum}äºº</span>
      </div>
      <div className="main">
        <p>æ”¯æŒäººæ•°dï¼š{supNum}äºº</p>
        <p>åå¯¹äººæ•°ï¼š{oppNum}äºº</p>
      </div>
      <div className="footer">
        <button onClick={handle.bind(null,'sup')}>æ”¯æŒ</button>

        <button onClick={handle.bind(null,'opp')}>åå¯¹</button>
      </div>
    </div>;
  }
```

#### 12.6.  useStateæ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥

<div style="color:red">`è¿™ç§æ–¹å¼æµ‹è¯•æ˜¯é”™è¯¯çš„ï¼Œå› ä¸ºhanlderæ˜¯ä¸€ä¸ªé—­åŒ…å‡½æ•°ï¼Œæ‹¿åˆ°çš„xè¿˜æ˜¯åŸæ¥çš„x</div>

`<span style="color:yellow">`æŸ¥çœ‹æ–¹å¼ï¼šåœ¨å‡½æ•°å¤´éƒ¨è¾“å‡ºå€¼ï¼ŒæŸ¥çœ‹useStateä¸­çš„å‡½æ•°æ‰§è¡Œåé‡æ–°æ‰§è¡Œäº†å‡ æ¬¡å‡½æ•°

<img src="image/3.reactç»„ä»¶/1692338256519.png" alt="1692338256519" style="zoom:50%;" />

`<span style="color:red">`å¼‚æ­¥æ›´æ–°åŸç†Â 

<img src="image/3.reactç»„ä»¶/1692338950921.png" alt="1692338950921" style="zoom:50%;" />



#### 12.7.ä½¿ç”¨flushSyncå°†å‡½æ•°ç»„ä»¶æ¸²æŸ“å˜æˆåŒæ­¥

<img src="image/3.reactç»„ä»¶/1692339662438.png" alt="1692339662438" style="zoom:50%;" />



`<span style="color:yellow">`æ›´æ–°åå½¢æˆä¸€ä¸ªæ–°çš„æ¸²æŸ“å‡½æ•°ï¼Œå†æ‰§è¡ŒsetZå—ï¼Œå°±å¯ä»¥æ‹¿åˆ°æ›´æ–°åçš„xï¼Œyçš„æ›´æ–°åçš„ä¸Šæ–‡çš„å€¼å—

```jsx
// ä¸ç®¡æ€ä¹ˆæ ·ï¼Œå¼‚æ­¥ä¸å¼‚æ­¥ï¼Œå‡½æ•°ç»„ä»¶ä¸­çš„å€¼ï¼Œåªèƒ½æ˜¯å½“å‰ä¸Šä¸‹æ–‡ï¼Œä½†æ˜¯ç»„ä»¶ç¡®å®æ˜¯æ›´æ–°äº†
function handleOpp() {
        flushSync(() => {
          setOppNum(oppNum + 1);
        });
        console.log("oppNum",oppNum) // è¿™é‡Œçš„å€¼è¿˜æ˜¯å½“å‰ä¸Šä¸‹æ–‡çš„å€¼ï¼Œä½¿ç”¨è¿™ä¸ªæ˜¯setStateå’ŒuseStateä¸­çš„flushSyncçš„åŒºåˆ«ï¼Œä½†æ˜¯å¯ä»¥æ‹¿åˆ°æ›´æ–°åçš„domå…ƒç´ ï¼ˆå’Œdomå…ƒç´ ä¸­æ›´æ–°åçš„å€¼ï¼‰ï¼ï¼ï¼ï¼ï¼ï¼
        setSupNum(supNum + 1);
    }
```

<div style="color:red">Ps:é™¤äº†ä¸èƒ½åƒsetStateåŒæ­¥åæ‹¿åˆ°åŒæ­¥åçš„å€¼ï¼Œå…¶ä»–éƒ½ä¸€æ ·  </div>

#### 12.8. react16ä¸­çš„useState

![1692340961312](image/3.reactç»„ä»¶/1692340961312.png)

#### 12.9 . forå¾ªç¯ä¸­çš„useState

<div style="color:yellow">forå¾ªç¯ä¸­çš„useState</div>

è¿™é‡Œæ¸²æŸ“ä¸€æ¬¡ï¼Œè§†å›¾ä¸­xçš„å€¼ä¸º11

<img src="image/3.reactç»„ä»¶/1692344733546.png" alt="1692344733546" style="zoom:50%;" />

<div style="color:yellow">forå¾ªç¯ä¸­çš„flushSyncå’ŒuseState</div>

```jsx
useStateçš„æ€§èƒ½ä¼˜åŒ–æœºåˆ¶
  1.æ¯æ¬¡returnæ›´æ–°å‰ä¼šæ‹¿ç°åœ¨çš„å€¼å’Œä¹‹å‰çš„çŠ¶æ€å€¼åšobject.isåšæ¯”è¾ƒï¼Œå¦‚æœä¸¤æ¬¡å€¼ä¸€æ ·å°±ä¸ä¼šåšæ›´æ–°ã€ç±»ä¼¼äºPureComponentåœ¨shouldComponneUpdateä¸­åšçš„ä¼˜åŒ–ã€‘

  2.ä¸ºä»€ä¹ˆä¸‹å›¾è¿™é‡Œ æ¸²æŸ“çš„ç»“æœxä¸º11ï¼Œæ‰“å°å‡ºæ¥ä¸¤æ¬¡â€œRENDERæ¸²æŸ“â€ ï¼Œ
  
      + ç¬¬ä¸€æ¬¡æ¸²æŸ“xä¸ºåä¸€ï¼Œ
			+ å½“ç¬¬äºŒæ¬¡è°ƒç”¨demoï¼Œæ‰§è¡Œåˆ°useStateçš„æ—¶å€™ä¼šæ¯”è¾ƒä¸¤æ¬¡çš„stateçš„å€¼ï¼Œè¿™é‡Œå‘ç°ä¸€æ ·ï¼Œå°±ä¸å†ç»§ç»­æ‰§è¡Œäº†
  
```

<img src="image/3.reactç»„ä»¶/1692346235306.png" alt="1692346235306" style="zoom:50%;" />



<div style="color:cyan">å¦‚ä½•å°†æ¸²æŸ“çš„ç»“æœå˜ä¸º20</div>

ç±»ä¼¼äºsetState,ä½¿ç”¨å‡½æ•°æ¥æ“ä½œ

<img src="image/3.reactç»„ä»¶/1692353779835.png" alt="1692353779835" style="zoom:50%;" />

#### 12.10. useStateçš„æ€§èƒ½æµªè´¹çš„é—®é¢˜

<img src="image/3.reactç»„ä»¶/1692355454746.png" alt="1692355454746" style="zoom: 33%;" />

<div style="color:cyan">è§£å†³æ€§èƒ½æµªè´¹çš„é—®é¢˜</div>

<div style="color:yellow">æºç ä¼šåœ¨ä¸ºåˆå§‹å€¼ç©ºçš„æ—¶å€™åˆ¤æ–­æ˜¯å¦ä¸ºå‡½æ•°ï¼Œå°†å…¶æ‰§è¡Œï¼Œå¦‚æœä¸ä¸ºç©ºï¼Œä¸ä¼šæ‰§è¡Œä¼ å…¥å€¼ä¸ºå‡½æ•°çš„æƒ…å†µ</div>

![1692355603675](image/3.reactç»„ä»¶/1692355603675.png)

<div style="color:yellow">è§£å†³åŠæ³•</div>

å°†ä¸éœ€è¦ç¬¬ä¸€æ¬¡è¿›æ¥å¤„ç†åˆå§‹å€¼çš„é€»è¾‘å†™å…¥å‡½æ•°ä¸­ï¼ˆåˆå§‹å€¼çš„æƒ°æ€§åŒ–å¤„ç†ï¼‰

<img src="image/3.reactç»„ä»¶/1692356195885.png" alt="1692356195885" style="zoom:50%;" />

### 13. useEffect

#### 13.1. ä½¿ç”¨useEffectçš„åŸå› 

```jsx
1. å¯ä»¥åœ¨å‡½æ•°ç»„ä»¶ä¸­ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸå‡½æ•°
```

#### 13.2. useEffectçš„ä½¿ç”¨

```jsx
useEffect(callback)
        + ç¬¬ä¸€æ¬¡æ¸²æŸ“å®Œæ¯•åæ‰§è¡Œcallbackï¼Œç›¸å½“äºcomponentDidMount
        + åœ¨æ¯æ¬¡çŠ¶æ€æ›´æ–°åéƒ½ä¼šæ‰§è¡Œcallbackï¼Œç›¸å½“componentDidUpdate
        + åœ¨ç»„ä»¶å†…èƒ½æ‹¿åˆ°æœ€æ–°çš„çŠ¶æ€å€¼
  
    useEffect(callback, []) 
        + ç¬¬ä¸€æ¬¡æ¸²æŸ“å®Œæ¯•åæ‰§è¡Œcallbackï¼Œç›¸å½“äºcomponentDidMount
        + æ¯ä¸€æ¬¡è§†å›¾æ›´æ–°å®Œæ¯•åcallbackä¸å†æ‰§è¡Œ
  
    useEffect(callback, [çŠ¶æ€å€¼1,....,çŠ¶æ€å€¼n])
        + ç¬¬ä¸€æ¬¡æ¸²æŸ“å®Œæ¯•åæ‰§è¡Œcallbackï¼Œç›¸å½“äºcomponentDidMount
        + æ¯ä¸€æ¬¡å¯¹åº”çš„çŠ¶æ€å€¼(ä¸€ä¸ªæˆ–è€…å¤šä¸ª)æ”¹å˜åï¼Œåéƒ½ä¼šæ‰§è¡Œcallback
  
    useEffect(() => {return () => {}}); // é‡Œé¢çš„returnçš„å‡½æ•°æ‰§è¡Œçš„æ—¶æœº
        + returnå‡½æ•°åœ¨ç»„ä»¶é‡Šæ”¾ï¼ˆæ›´æ–°æˆ–è€…å¸è½½ï¼‰åæ‰§è¡Œï¼Œå¯ä»¥ç†è§£ä¸ºå½“ç»„ä»¶æ›´æ–°ï¼Œé‡Šæ”¾åŸæ¥çš„ç»„ä»¶ï¼Œå°±æ‰§è¡Œreturné‡Œé¢çš„å‡½æ•°ï¼Œæ‰€ä»¥returné‡Œé¢çš„å‡½æ•°æ‹¿åˆ°çš„æ˜¯ä¸Šä¸€æ¬¡çš„çŠ¶æ€å€¼ /*ï¼ˆç»„ä»¶é‡Šæ”¾ä¼šé‡Šæ”¾è™šæ‹Ÿdomï¼ŒçœŸå®domï¼Œåˆæˆäº‹ä»¶ï¼ˆè§£é™¤å…³è”ï¼‰ç­‰ï¼Œæ‰€ä»¥ä½ æ‹¿ä¸åˆ°å¯¹åº”çš„domå€¼ã€æƒ³è¦æ‹¿åˆ°å€¼ï¼Œå¯ä»¥å§domèµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ã€‘ï¼‰*/
	
		 useEffect(() => {return () => {}},[])
			  + returnå‡½æ•°åœ¨ç»„ä»¶å¸è½½åæ‰§è¡Œ



```

#### 13.3. useffectçš„åŸç†

<img src="image/3.reactç»„ä»¶/1692360293201.png" alt="1692360293201" style="zoom:50%;" />

#### 13.4.  useEffectç»†èŠ‚ç‚¹

```jsx
1.useEffectå¿…é¡»åœ¨æœ€å¤–å±‚ä½¿ç”¨ï¼Œä¸èƒ½è¿›è¡ŒåŒ…è£¹
useEffect(()=>{
	if(num>5){
		...do someting
	}
},[num])
```

```jsx
2. å¦‚ä½•è·å–æœåŠ¡å™¨æ•°æ®
	// é”™è¯¯è§£å†³æ–¹æ¡ˆ
        useEffect( async ()=>{
            ...è·å–æœåŠ¡å™¨æ•°æ®ä»£ç  // è¿™é‡ŒæŠ¥é”™
        },[])

		ps: åŸå› ï¼šuseEffectè¦è¿”å›çš„è¯å¿…é¡»ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œasyncè¿”å›çš„æ˜¯ä¸€ä¸ªpromiseå¯¹è±¡
  
 
  // è§£å†³åŠæ³•ä¸€ï¼š
    	ä½¿ç”¨.thenæ–¹æ³•

	// è§£å†³åŠæ³•äºŒï¼ŒåŒ…è£¹ä¸€å±‚å°å‡½æ•°
        useEffect( ()=>{
         let a = ()=>{
            	 ...è·å–æœåŠ¡å™¨æ•°æ®ä»£ç  // è¿™é‡ŒæŠ¥é”™
          }
           a()
        },[])
```

### 14. useLayoutEffect

#### 14.1. ä½¿ç”¨useLayoutçš„åŸå› 

```jsx
function Vote() {
    let [num,setNum] = useState(0);
    console.log("render")
    useLayoutEffect(()=>{
        if(num===0){
            setNum(1)
        }
    },[num])
    // useEffect(()=>{
    //     if(num===0){
    //         setNum(1)
    //     }
    // },[num])

    const changeColor = () => {
        setNum(0)
    }
    return <div className="vote-box">
      <span style={{color:num===0?'red':'green'}}>{num}</span>
      <div className="footer">
        <button onClick={changeColor}>æ”¹å˜é¢œè‰²</button>
      </div>
    </div>;
  }
	// ç¬¬ä¸€æ¬¡æ¸²æŸ“ï¼Œæ¸²æŸ“å®Œæ¯•ï¼Œæ‰§è¡ŒuseEffect/useLayoutEffectï¼Œå†æ¬¡æ¸²æŸ“ï¼Œ

  1.ç‚¹å‡»changeColorï¼Œæ‰§è¡ŒsetNumï¼Œå†æ¬¡æ¸²æŸ“ï¼Œå†æ‰§è¡ŒuseEffectï¼Œå†æ¬¡æ¸²æŸ“(åå¤åˆ‡æ¢ï¼Œåå¤æ¸²æŸ“ä¸¤æ¬¡ï¼Œä¼šçœ‹è§é¡µé¢å‡ºç°çº¢è‰²å’Œç»¿è‰²çš„é—ªçƒæ•ˆæœ), ä¸¤æ¬¡æ¸²æŸ“çš„ç»“æœï¼ˆè¾“å‡ºrenderï¼‰ä¸åƒuseLayoutEffecté‚£æ ·å‡ ä¹åŒæ—¶æ¸²æŸ“

 2. ä½¿ç”¨useLayoutEffect,æ¯æ¬¡å‡½æ•°è¿›æ¥æ¸²æŸ“å’Œä½¿ç”¨useLayoutEffectæ”¹å˜çŠ¶æ€ï¼Œéƒ½ä¼šæ¸²æŸ“ï¼Œä½†æ˜¯å‡ ä¹æ˜¯åŒæ—¶æ¸²æŸ“ï¼ˆå‡ ä¹åŒæ—¶è¾“å‡ºrenderï¼‰ï¼Œçœ‹ä¸åˆ°çº¢ç»¿é—ªçƒçš„ç”»é¢

```

#### 14.2. useLayoutEffectçš„æ¸²æŸ“åŸç†

```jsx
 1.è§†å›¾æ¸²æŸ“æ˜¯å››æ­¥ï¼š
 			1.babel-preset-react-appç¼–è¯‘jsxè¯­æ³•ï¼Œ
			2.æ‰§è¡Œå‡½æ•°ï¼Œç”Ÿæˆè™šæ‹Ÿdom 
      3.è™šæ‹Ÿdomè½¬æ¢ä¸ºçœŸå®dom 
      	useLayoutEffectä¼šé˜»å¡ç¬¬å››æ­¥æ“ä½œï¼Œå…ˆå»æ‰§è¡Œcallbackå‡½æ•°ï¼ˆåŒæ­¥ï¼‰
      4.æµè§ˆå™¨ç»˜åˆ¶
 				useEffectï¼ˆ/*å®˜æ–¹å»ºè®®ä½¿ç”¨*/ï¼‰
  
 2. seEffectå’ŒuseLayoutEffectçš„åŒºåˆ«:
			+ useEffectçš„callbackæ‰§è¡Œçš„æ—¶å€™ï¼ŒçœŸå®domå·²ç»å‡ºæ¥äº†ï¼Œæµè§ˆå™¨å·²ç»ç»˜åˆ¶äº†ï¼Œcallbackå†æ¬¡æ„å»ºçœŸå®domï¼Œå†æ¬¡è¿›è¡Œæµè§ˆå™¨ç»˜åˆ¶ï¼Œæ‰€ä»¥ä¼šå‡ºç°é—ªçƒçš„ç”»é¢
      + è€ŒuseLayoutEffectçš„callbackæ‰§è¡Œçš„æ—¶å€™ï¼Œhtmlæ–‡æ¡£æ ‘å‡ºæ¥äº†ï¼›ï¼Œä½†æ˜¯æµè§ˆå™¨è¿˜æ²¡æœ‰ç»˜åˆ¶ï¼Œä¸¤æ¬¡ä¼šåˆå¹¶htmlæ–‡æ¡£æ ‘ï¼Œæ‰§è¡Œæµè§ˆå™¨ç»˜åˆ¶ï¼Œæ‰€ä»¥çœ‹ä¸åˆ°é—ªçƒçš„ç”»é¢

3. ä¸¤è€…çš„æ‰§è¡Œé¡ºåºï¼šæ‰€ä»¥useLayoutEffectçš„æ–¹æ³•æ¯”useEffectä¼˜å…ˆæ‰§è¡Œ

4. æ‰€ä»¥useLayoutEffectå¯ä»¥æ‹¿åˆ°dom

5. æ‰€ä»¥useLayoutEffectä¼šé˜»å¡æµè§ˆå™¨æ¸²æŸ“çœŸå®dom
```

<img src="image/3.reactç»„ä»¶/1692366896161.png" alt="1692366896161" style="zoom:50%;" />

![1692368251498](image/3.reactç»„ä»¶/1692368251498.png)

### 14. useRef

#### 14.1. refè·å–domå…ƒç´ <ä¸æ¨è>

```jsx
function Vote() {
    let [num,setNum] = useState(0);
    let instance
    useEffect(()=>{
       console.log("instance",instance)
    })

    const changeColor = () => {
        setNum(num+1)
    }
    return <div className="vote-box">
      <span 
        ref={(vc)=>instance=vc}  // refåƒç±»ç»„ä»¶ä¸€æ ·è·å–dom
        >{num}</span>
      <div className="footer">
        <button onClick={changeColor}>button</button>
      </div>
    </div>;
  }


```

#### 14.2. ä½¿ç”¨currentRefè·å–å¯¹è±¡

```jsx
let instance = React.createRef(); //åˆ›å»ºä¸€ä¸ªrefå¯¹è±¡
<span ref={instance}></span>
```

#### 14.3. ä½¿ç”¨useRefè·å–å¯¹è±¡

```jsx
let instance = useRef(null);  //åˆ›å»ºä¸€ä¸ªrefå¯¹è±¡
  <span ref={instance}></span>
```

#### 14.4. useRefå’ŒcreateRefçš„åŒºåˆ«

```jsx
1. æ¯ä¸€æ¬¡ç»„ä»¶æ¸²æŸ“createRefä¼šé‡æ–°åˆ›å»ºä¸€ä¸ªrefå¯¹è±¡ï¼Œè€ŒuseRefä¸ä¼šï¼Œæ‰€ä»¥useRefæ€§èƒ½æ›´å¥½

// ä»£ç 
let prev1,prev2
function Vote() {
    let [num,setNum] = useState(0);
    let instance = useRef(null); 
    let instance1 = React.createRef();
    if(!prev1){
        // ç¬¬ä¸€æ¬¡æ¸²æŸ“
        prev1 = instance
        prev2 = instance1
    }else{
        // ç»„ä»¶æ›´æ–°ï¼ŒéªŒè¯æ–°åˆ›å»ºçš„refå¯¹è±¡ï¼Œå’Œä¹‹å‰åˆ›å»ºçš„æ˜¯å¦ä¸€è‡´
        console.log("prev1",prev1 === instance) // true userefæ¯ä¸€æ¬¡ç»„ä»¶æ›´æ–°ï¼Œéƒ½æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œä¸ä¼šåˆ›å»ºæ–°çš„refå¯¹è±¡ï¼Œè¿˜æ˜¯åŸæ¥çš„refå¯¹è±¡[å¼•ç”¨åœ°å€æ˜¯åŒä¸€ä¸ªï¼Œèµ‹å€¼åä¸¤è€…ç”¨çš„éƒ½æ˜¯ä¸€ä¸ªå †]
        console.log("prev2",prev2 === instance1) // falseï¼Œ
        // åˆ›å»ºäº†æ–°çš„refå¯¹è±¡ï¼Œä¸¤æ¬¡è™½ç„¶çœ‹èµ·æ¥ä¸€æ ·ï¼Œä½†æ˜¯å¼•ç”¨åœ°å€å·²ç»å˜äº†

        // æ‰€ä»¥useRefç›¸æ¯”äºcreateRefï¼Œæ›´åŠ èŠ‚çœæ€§èƒ½
    }
    useEffect(()=>{
       console.log("createRef",instance.current)
       console.log("useRef",instance.current)
    })

    const changeColor = () => {
        setNum(num+1)
    }
    return <div className="vote-box">
      <span ref={instance} >{num}</span>
      <span ref={instance1} >{num}</span>
      <div className="footer">
        <button onClick={changeColor}>æ”¹å˜é¢œè‰²</button>
      </div>
    </div>;
  }
```

#### 14.5.ä½¿ç”¨useRefè·å–ç±»ç»„ä»¶çš„å®ä¾‹

#### 14.6.è·å–å‡½æ•°ç»„ä»¶çš„æŸä¸ªå…ƒç´ r

```jsx
const Ak = React.forwardRef((props,ref)=>{
    console.log("ref",ref) // åœ¨demoä¸­è°ƒç”¨akæ—¶å€™ï¼Œä¼ é€’çš„refå¯¹è±¡
    return <div ref={ref}>
        æˆ‘æ˜¯ä¸€ä¸ªå‡½æ•°ç»„ä»¶
    </div>
})
function Vote() {
    let instance = useRef(null); 
    useEffect(()=>{
        console.log(instance.current);
    },[])
    return <div className="vote-box">
      <Ak ref={instance}></Ak>
    </div>;
  }
```

#### 14.7.è·å–å‡½æ•°ç»„ä»¶çš„æ–¹æ³•å’ŒçŠ¶æ€

```jsx

// useImperativeHandle
const Ak = React.forwardRef((props,ref)=>{
    let [state,setState] = useState(0);
    const handle = ()=>{
        setState(state+1);
    }
    useImperativeHandle(ref, () => {return { //æš´éœ²ç»™çˆ¶ç»„ä»¶çš„å®ä¾‹å€¼,ç±»ä¼¼äºvueçš„defineExpose
        state,
    }});
    return <div ref={ref} onClick={handle}>
        æˆ‘æ˜¯ä¸€ä¸ªå‡½æ•°ç»„ä»¶{state}
    </div>
})
function Vote() {
    let instance =useRef(null); 
    useEffect(()=>{
        console.log(instance);
    },[])
    return <div className="vote-box">
      <Ak ref={instance}></Ak>
    </div>;
  }
```

### 15. useMemo

#### 15.1.ä½¿ç”¨useMemoçš„åŸå› 

<img src="image/3.reactç»„ä»¶/1692412329348.png" alt="1692412329348" style="zoom:50%;" />

#### 15.2. å¦‚ä½•ä½¿ç”¨

```jsx
1. ç›¸å½“äºcomponentWillMountå’ŒcomponentWillUpdateï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ®ä¾èµ–çš„å€¼å†³å®šæ˜¯å¦æ›´æ–°
	ps: æ¯”èµ·useEffectï¼Œåªæ›´æ–°ä¸€æ¬¡ï¼ŒuseEffectä¼šåœ¨æ›´æ–°å®Œæˆåï¼Œå†æ¬¡æ›´æ–°
	ps: ç›¸å½“äºvueçš„computed
let total = useMemo(()=>{
        return Math.ceil((supNum/(oppNum+supNum))*100)
    },[supNum,oppNum])
```

<img src="image/3.reactç»„ä»¶/1692412893989.png" alt="1692412893989" style="zoom:50%;" />

### 16. useCallback

#### 16.1. ä½¿ç”¨useCallbackçš„åŸå› 

![1692413208168](image/3.reactç»„ä»¶/1692413208168.png)

#### 16.2. useCallbackçš„ç‰¹ç‚¹

```jsx
1. å¹¶ä¸æ˜¯æ‰€æœ‰çš„å‡½æ•°éƒ½é€‚åˆuseCallback
2. å¦‚æœç¬¬äºŒä¸ªå‚æ•°ä¸ºç©ºé‡Œé¢çš„ä¸Šä¸‹æ–‡æ°¸è¿œæ˜¯ç¬¬ä¸€æ¬¡æ‰§è¡Œçš„ä¸Šä¸‹æ–‡ï¼Œè¯¦è§18.3å‡½æ•°ç»„ä»¶çˆ¶å­é€šè¡Œä¸­ä¸ºä»€ä¹ˆåŠ äº†callbackï¼Œå€¼æ²¡æœ‰å‘ç”Ÿå˜åŒ–
3. ç¬¬äºŒä¸ªå‚æ•°æ•°ç»„å¯ä»¥åŒ…å«å¯¹åº”éœ€è¦å˜åŒ–çš„å€¼ï¼Œå½“å€¼å˜åŒ–çš„æ—¶å€™ä¹Ÿä¼šåˆ›å»ºä¸€ä¸ªå½“å‰æ‰§è¡Œèµ·ä¸Šä¸‹æ–‡çš„å‡½æ•°
```

![1692413451434](image/3.reactç»„ä»¶/1692413451434.png)

#### 16.3. useCallBackä½¿ç”¨åœºæ™¯

```jsx
1. çˆ¶ç»„ä»¶åµŒå¥—å­ç»„ä»¶ï¼Œçˆ¶ç»„ä»¶è¦æŠŠå†…éƒ¨çš„å‡½æ•°åŸºäºå±æ€§ä¼ é€’ç»™å­ç»„ä»¶ï¼Œæ­¤æ—¶ä¼ é€’çš„è¿™ä¸ªæ–¹æ³•ï¼Œä½¿ç”¨useCallbackå¤„ç†ä¸€ä¸‹
```

<div style="color:cyan">å¦‚ä½•åœ¨çˆ¶ç»„ä»¶ï¼ˆå‡½æ•°ç»„ä»¶ï¼‰æ›´æ–°çš„æ—¶å€™å­ç»„ä»¶(ç±»ç»„ä»¶)ä¸æ›´æ–°</div>

<img src="image/3.reactç»„ä»¶/1692414348378.png" alt="1692414348378" style="zoom:50%;" />

<img src="image/3.reactç»„ä»¶/1692414386186.png" alt="1692414386186" style="zoom:50%;" />

<div style="color:cyan">å¦‚ä½•åœ¨çˆ¶ç»„ä»¶ï¼ˆå‡½æ•°ç»„ä»¶ï¼‰æ›´æ–°çš„æ—¶å€™å­ç»„ä»¶(å‡½æ•°ç»„ä»¶)ä¸æ›´æ–°</div>

<div style="color:yellow">ä½¿ç”¨React.memoåŒ…è£¹å‡½æ•°ç»„ä»¶</div>

```jsx
1. å‡½æ•°ç»„ä»¶æ ¹æ®React.memoå‡½æ•°ï¼Œå¯¹æ–°è€ä¼ é€’çš„å±æ€§å€¼åšæ¯”è¾ƒï¼Œå¦‚æœä¸ä¸€è‡´ï¼Œæ‰ä¼šå°†å‡½æ•°ç»„ä»¶æ‰§è¡Œï¼Œå¦‚æœä¸€è‡´ï¼Œçˆ¶ç»„ä»¶çš„æ›´æ–°ä¸ä¼šå¯¼è‡´å­ç»„ä»¶æ›´æ–°
```

### 17. è‡ªå®šä¹‰hookç»„ä»¶(ç±»ä¼¼äºvueçš„mixin)

```jsx
1.å°†å…¬å…±çš„é€»è¾‘è¿›è¡Œå°è£…
```

#### 17.1.useStateæ”¯æŒéƒ¨åˆ†çŠ¶æ€çš„æ›´æ”¹

![1692415965349](image/3.reactç»„ä»¶/1692415965349.png)

### 18. çˆ¶å­ç»„ä»¶é€šä¿¡

#### 18.1. çˆ¶å­ç»„ä»¶é€šä¿¡çš„æ€è·¯

<img src="image/3.reactç»„ä»¶/1692500664520.png" alt="1692500664520" style="zoom:50%;" />

#### 18.2.ç±»ç»„ä»¶å®ç°ç»„ä»¶é€šä¿¡

```jsx
1. æ ¸å¿ƒï¼Œå°†å±æ€§å’Œå‡½æ•°å½“å±æ€§ä¼ é€’ç»™å­ç»„ä»¶
2. å­ç»„ä»¶æ¥æ”¶å‡½æ•°ï¼Œä¹Ÿå¯ä»¥ä¼ é€’å€¼ç»™çˆ¶ç»„ä»¶
ps: antdç»„ä»¶è°ƒç”¨å°±æ˜¯çˆ¶å­ç»„ä»¶é€šä¿¡
// çˆ¶ç»„ä»¶
class Vote extends React.Component {
    state = {
        oppNum:0,
        supNum:0
    }
    updateOpp=(num)=>{
        this.setState({
            oppNum: this.state.oppNum + num
        })
    }
    updateSup=(num)=>{ // è¿™é‡Œå¿…é¡»ä½¿ç”¨ç®­å¤´å‡½æ•°ï¼Œä¸ç„¶thisä¼šå‡ºç°é—®é¢˜ï¼ˆä¹Ÿå¯ä»¥åœ¨ä¼ å€¼çš„æ—¶å€™bind thisï¼‰
        this.setState({
            supNum: this.state.supNum + num
        })
    }
    render() {
        return <div className="vote-box">
            <div className="header">
                <h2 className="title">Reactæ˜¯å¾ˆæ£’çš„å‰ç«¯æ¡†æ¶</h2>
                <span className="num">{this.state.oppNum + this.state.supNum}</span>
            </div>
            <VoteMain state={this.state} />
            <VoteFooter updateOpp={this.updateOpp}  updateSup = {this.updateSup}/>
        </div>;
    }
}

// å­ç»„ä»¶
class VoteMain extends React.Component {
    constructor(props){
        super(props)
    }
    render() {
        let {supNum,oppNum} = this.props.state
        return <div className="main">
            <p>æ”¯æŒäººæ•°ï¼š{oppNum}äºº</p>
            <p>åå¯¹äººæ•°ï¼š{supNum}äºº</p>
            <p>æ”¯æŒæ¯”ç‡ï¼š{(oppNum + supNum) ? Math.floor(oppNum/(supNum+oppNum)*100):0}%</p>
        </div>;
    }
}

// å­ç»„ä»¶
class VoteFooter extends React.PureComponent { // è¿™ä¸ªé‡Œé¢çš„å±æ€§å€¼ä¸ä¼šå‘ç”Ÿæ”¹å˜ï¼Œè¿™ä¸ªç»„ä»¶å°±ä¸ä¼šåœ¨çˆ¶ç»„ä»¶æ›´æ–°æ—¶æ›´æ–°äº†
    constructor(props) {
        super(props)
    }
    render() {
        let {updateSup,updateOpp} = this.props
        return <div className="footer">
            <Button type="primary" onClick={updateOpp.bind(this,1)}>æ”¯æŒ</Button>
            <Button type="primary" onClick={updateSup.bind(this,1)} danger>åå¯¹</Button>
        </div>;
    }
}
```

#### 18.3. å‡½æ•°ç»„ä»¶çˆ¶å­é€šä¿¡

```jsx
1.useCallbackçš„é—®é¢˜ï¼Œä¸ºä»€ä¹ˆåŠ ä¸Šäº†ä¹‹åï¼Œç‚¹å‡»å‡½æ•°ä¹‹å å€¼æ²¡æœ‰å˜åŒ–

const Vote = function Vote() {
    let [oppNum,setOppNum] = useState(0)
    let [supNum,setSupNum] = useState(0)
     // ä¸ºä»€ä¹ˆæ·»åŠ äº†useCallbackä¹‹åï¼ˆç¬¬äºŒä¸ªå‚æ•°ä¸º[]ï¼‰ï¼ŒçŠ¶æ€å€¼æ— æ³•æ›´æ–°äº†ï¼ˆç”¨åˆ°çš„å€¼æ°¸è¿œæ˜¯ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„æ—¶å€™çš„ä¸Šä¸‹æ–‡ï¼‰
    let change = useCallback( (value)=>{  
        if(value ==="sup"){
            setSupNum(supNum + 1)
            return;
        }
        setOppNum(oppNum + 1)
    }, [supNum,oppNum]) // è¿™é‡Œå…¶å®å¯ä»¥ä¸ç”¨ä½¿ç”¨useCallback,å› ä¸ºæ¯ä¸€æ¬¡æ›´æ–°ï¼Œè¿™ä¸¤ä¸ªå€¼å…¶ä¸­ä¸€ä¸ªéƒ½ä¼šå‘ç”Ÿå˜åŒ–
  
    return <div className="vote-box">
        <div className="header">
            <h2 className="title">Reactæ˜¯å¾ˆæ£’çš„å‰ç«¯æ¡†æ¶</h2>
            <span className="num">0</span>
        </div>
        <VoteMain state = {{oppNum:oppNum,supNum:supNum}}/>
        <VoteFooter change = {change}/>
    </div>;
};

// å­ç»„ä»¶
const VoteFooter = React.memo((props) => {
    console.log("footç»„ä»¶æ›´æ–°")
    let {change} = props
    return <div className="footer">
        <Button type="primary" onClick = {change.bind(null,'opp')}>æ”¯æŒ</Button>
        <Button type="primary" danger onClick = {change.bind(null,'sup')}>åå¯¹</Button>
    </div>;
})


// å­ç»„ä»¶
const VoteMain = function VoteMain(props) {
    let {supNum,oppNum} = props.state 

    let percent = useMemo(()=>{ // è®¡ç®—å±æ€§ï¼Œå½“oppNumå’ŒsupNumå˜åŒ–çš„æ—¶å€™æ‰ä¼šè§¦å‘
        return (oppNum+supNum) ? Math.floor(oppNum/(oppNum+supNum)*100):0
    },[oppNum,supNum])

    return <div className="main">
        <p>æ”¯æŒäººæ•°ï¼š{oppNum}äºº</p>
        <p>åå¯¹äººæ•°ï¼š{supNum}äºº</p>
        <p>æ”¯æŒæ¯”ç‡ï¼š{percent}%</p>
    </div>;
};
```

<div style="color:cyan">useCallbackæ²¡æœ‰å˜åŒ–çš„åŸå› </div>

<div style="color:yellow">useCallbackåŒ…è£¹çš„ç»„ä»¶ï¼Œä¸ä¼šåœ¨æ¸²æŸ“åé‡æ–°åˆ›å»ºï¼Œé‡Œé¢çš„å€¼ä¹Ÿåªä¼šæ‹¿åˆ°ç¬¬ä¸€æ¬¡åˆ›å»ºçš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œæ‰€ä»¥å¯¼è‡´ç‚¹å‡»ä¹‹åï¼Œå€¼ä¸ä¼šå‘ç”Ÿå˜åŒ–</div>

<img src="image/3.reactç»„ä»¶/1692506935841.png" alt="1692506935841" style="zoom:50%;" />

### 19. ç¥–å…ˆåä»£ç»„ä»¶é€šä¿¡

#### 19.1 . é€šä¿¡çš„æ€è·¯

![1692508116132](image/3.reactç»„ä»¶/1692508116132.png)

#### 19.2. ç¥–å…ˆå…ƒç´ é€šä¿¡ï¼ˆç±»ç»„ä»¶ï¼‰

<div style="color:cyan">1.åˆ›å»ºä¸Šä¸‹æ–‡å¯¹è±¡</div>

```jsx
import React from "react"
const ThemeContext  = React.createContext()// åˆ›å»ºä¸Šä¸‹æ–‡å¯¹è±¡
export default ThemeContext
```

<div style="color:cyan">2.ç¥–å…ˆå…ƒç´ è°ƒç”¨æ–¹æ³•å°†ä¿®æ”¹çš„ä¿¡æ¯å­˜å‚¨åˆ°ä¸Šä¸‹æ–‡ä¸­</div>

```jsx
  import ThemeContect from "@/ThemeContext";
 // é€šè¿‡ThemeContect.Providerç»„ä»¶ä¸­çš„value(å€¼æ˜¯ä¸€ä¸ªå¯¹è±¡)ï¼Œå¯ä»¥å°†ä¿¡æ¯å­˜å‚¨åœ¨ä¸Šä¸‹æ–‡ä¸­ï¼Œ
 //  å½“renderå‡½æ•°æ‰§è¡Œï¼Œå¯ä»¥å°†æœ€æ–°çš„ä¿¡æ¯æ”¾å…¥åˆ°ä¸Šä¸‹æ–‡ä¸­
return <ThemeContect.Provider value={{
            oppNum:this.state.oppNum,
            supNum:this.state.supNum,
            updateOpp: this.updateOpp,
            updateSup:this.updateSup
        }}>
            ...å­ç»„ä»¶ä»£ç 
        </ThemeContect.Provider>
```

<div style="color:cyan">3.åä»£ç»„ä»¶è·å–ç¥–å…ˆç»„ä»¶ä¼ é€’çš„å€¼<div>

<div style="color:yellow">æ–¹æ¡ˆä¸€ï¼šå¯¼å…¥ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œstatic contextTypeæ¥æ”¶ï¼Œä½¿ç”¨this.contextè·å–å€¼</div>

```jsx
import ThemContext from "@/ThemeContext"
æ–¹æ¡ˆä¸€
class VoteMain extends React.Component {
    static contextType = ThemContext // è®¾ç½®é™æ€å±æ€§contextType(å¿…é¡»ä¸ºè¿™ä¸ªåå­—)ï¼Œå°†ä¸Šä¸‹æ–‡ä¿¡æ¯æ”¾åœ¨å½“å‰å®ä¾‹çš„contextä¸Š
    render() {
        let {supNum,oppNum} = this.context
        return <div className="main">
            <p>æ”¯æŒäººæ•°ï¼š{oppNum}äºº</p>
            <p>åå¯¹äººæ•°ï¼š{supNum}äºº</p>
            <p>æ”¯æŒæ¯”ç‡ï¼š{(oppNum + supNum) ? Math.floor(oppNum/(supNum+oppNum)*100):0}%</p>
        </div>;
    }
}
```

<div style="color:yellow">æ–¹æ¡ˆäºŒï¼šThemeContext.Consumeræ¥è°ƒç”¨</div>

```jsx
class VoteMain extends React.Component {
    render() {
        // ä½¿ç”¨ThemContext.Consumeræ¥è·å–, å¿…é¡»ç”¨ä¸€ä¸ªå‡½æ•°æ¥åŒ…è£¹è¿”å›çš„jsxï¼Œå‡½æ•°ç»„ä»¶ä¼šä¼ å…¥ä¸€ä¸ªcontext
        return <ThemContext.Consumer> 
            {
                (context)=>{ // contextä¸ºä¸Šä¸‹æ–‡çš„ä¿¡æ¯
                    let {supNum,oppNum} = context
                   return <div className="main">
                        <p>æ”¯æŒäººæ•°ï¼š{oppNum}äºº</p>
                        <p>åå¯¹äººæ•°ï¼š{supNum}äºº</p>
                        <p>æ”¯æŒæ¯”ç‡ï¼š{(oppNum + supNum) ? Math.floor(oppNum/(supNum+oppNum)*100):0}%</p>
                     </div>;
                }
            }
    
        </ThemContext.Consumer>
    }
}
```

#### 19.3 ç¥–å…ˆç»„ä»¶é€šä¿¡ï¼ˆå‡½æ•°ç»„ä»¶ï¼‰

```jsx
1.æ„å»ºcontextå’Œçˆ¶ç»„ä»¶ä¼ å­å’Œç±»ç»„ä»¶ä¸€æ ·
```

<div style="color:yellow">æ–¹æ¡ˆä¸€ï¼šå’Œç±»ç»„ä»¶ä¸€æ ·é€šè¿‡ThemeContext.provideæ¥æ”¶context</div>

![1692517952525](image/3.reactç»„ä»¶/1692517952525.png)

<div style="color:yellow">æ–¹æ¡ˆäºŒï¼šä½¿ç”¨useContext</div>

```jsx
import React ,{useMemo,useContext} from "react";

import ThemeContext from "@/ThemeContext"

const VoteMain = function VoteMain() {
    let {supNum,oppNum} = useContext(ThemeContext)

    let percent = useMemo(()=>{ 
        return (oppNum+supNum) ? Math.floor(oppNum/(oppNum+supNum)*100):0
    },[oppNum,supNum])

    return  <div className="main">
   
    </div>;
};
```

#### 19.4. å¹³è¡Œç»„ä»¶é€šä¿¡ä¹Ÿå¯ä»¥å°†éœ€è¦çš„çŠ¶æ€ä¿¡æ¯æŒ‚è½½åˆ°çˆ¶ç»„ä»¶ä¸Šï¼Œå°±å¯ä»¥æ‹¿åˆ°å¯¹é¢çš„å€¼äº†

```jsx
1.ä½†æ˜¯ä¸€èˆ¬ä½¿ç”¨æœ€å¤šçš„æ˜¯reduxæ¥åšï¼Œè¿™æ ·é€»è¾‘å¤ªæ··ä¹±äº†
```

### 20. é«˜é˜¶ç»„ä»¶

```jsx
1.ä½¿ç”¨é—­åŒ…[æŸ¯é‡ŒåŒ–]å®ç°çš„ç»„ä»¶ä»£ç†
2. react-reduxï¼Œreact-router-domä¸­éƒ½ä¼šä½¿ç”¨åˆ°ï¼Œä»¥åŠåœ¨ç±»ç»„ä»¶ä¸­ä½¿ç”¨reactjss
```

<img src="image/3.reactç»„ä»¶/1692533747571.png" alt="1692533747571" style="zoom:50%;" />

<div style="color:cyan">å¥½å¤„:å¯ä»¥åœ¨è°ƒç”¨demoå‰ï¼Œä¸ä»…å¯ä»¥æ‹¿åˆ°çˆ¶ç»„ä»¶çš„propsï¼Œç”šè‡³å¯ä»¥åœ¨æ‹¿åˆ°propsæ—¶å€™åšå¤„ç†åå†ä¼ é€’ç»™demo</div>

<img src="image/3.reactç»„ä»¶/1692533943426.png" alt="1692533943426" style="zoom:50%;" />

### 21. useReduceræ˜¯å¯¹useStateçš„å‡çº§

<div style="color:cyan">ä½¿ç”¨useStateæ¥åšå¢åŠ å‡å°‘</div>

```jsx
import React ,{useState,useReducer} from 'react';
function A1() {
  let [num,setNum] = useState(0)
  return (
    <div>
      <h1>A1,{num}</h1>
      <br / >
      <button onClick={
        ()=>{
          setNum(num+1)
        }
      }>å¢åŠ </button>
      <button onClick={
        ()=>{
          setNum(num-1)
        }
      }>å‡å°‘</button>
    </div>
  );
}
export default A1;
```

<div style="color:cyan">ä½¿ç”¨useReduceræ¥åšå¢åŠ å‡å°‘</div>

```jsx
// ç›¸å½“äºåœ¨å½“å‰ç»„ä»¶ä¸­åˆ›å»ºä¸€ä¸ªstoreå®¹å™¨ï¼Œ initialState å°±æ˜¯åˆå§‹å€¼ï¼Œ reducerå°±æ˜¯çŠ¶æ€ç®¡ç†å‘˜ï¼Œactionå°±æ˜¯æ´¾å‘çš„è¡Œä¸ºæ ‡è¯†ï¼Œdispatchå°±æ˜¯æ´¾å‘è¡Œä¸ºæ ‡è¯†é€šçŸ¥reduceræ‰§è¡Œäº‹ä»¶æ± çš„å‡½æ•°ï¼Œé€šçŸ¥çŠ¶æ€æ›´æ–°ï¼ŒçŠ¶æ€æ›´æ–°å°†ç»„ä»¶æ›´æ–°æ‹¿åˆ°æœ€æ–°çš„stateçš„å€¼

// å¦‚æœç»„ä»¶ä¸­å­˜åœ¨å¤§é‡çš„çŠ¶æ€ï¼Œä½¿ç”¨useReducerä¼šæ›´å¥½ï¼Œä¸éœ€è¦ä¸€ä¸ªä¸€ä¸ªçš„å»åˆ›å»ºçŠ¶æ€ï¼Œå¹¶ä¸”é€»è¾‘éƒ½ç»Ÿä¸€åŒ–äº†
import React ,{useState,useReducer} from 'react';
const initialState ={
  num:0
};
let reducer = (state,action)=>{
  switch(action.type){
    case "add":
      state.num++;
      break;
    case "sub":
      state.num--;
      break;
  }
  return {...state};
}
function A1() {
  let [state,dispatch] = useReducer(reducer,initialState)
  return (
    <div>
      <h1>A1,{state.num}</h1>
      <br / >
      <button onClick={
        ()=>{
          dispatch({type:"add"})
        }
      }>å¢åŠ </button>
      <button onClick={
        ()=>{
          dispatch({type:"sub"})
        }
      }>å‡å°‘</button>
    </div>
  );
}
export default A1;
```

